## 第4章 变量、作用域与内存

>为了未来，冲。

- 1.给变量加标记的方式有很多种。比如，当变量进入上下文时，反转某一位；或者可以维护“在上下文中”和“不在上下文中”两个变量列表，可以把变量从一个列表转移到另一个列表。标记过程的实现并不重要，关键是策略。 --摘抄

- 2.垃圾回收程序运行的时候，会标记内存中存储的所有变量（记住，标记方法有很多种）。然后，它会将所有在上下文中的变量，以及被在上下文中的变量引用的变量的标记去掉。在此之后再被加上标记的变量就是待删除的了，原因是任何在上下文中的变量都访问不到它们了。随后垃圾回收程序做一次内存清理，销毁带标记的所有值并收回它们的内存。 --摘抄

- 3.循环引用。所谓循环引用，就是对象A有一个指针指向B，而对象B也引用了对象A。 --摘抄

- 4.为了补救这一点，IE9把BOM和DOM对象都改成了JavaScript对象，这同时也避免了由于存在两套垃圾回收算法而导致的问题，还消除了常见的内存泄露现象。 --摘抄

- 5.垃圾回收程序会周期性运行，如果内存中分配了很多变量，则可能造成性能损失，因此垃圾回收的时间调度很重要。 --摘抄

- 6.开发者不知道什么时候运行时会收集垃圾，因此最好的办法是在写代码时就要做到：无论什么时候开始收集垃圾，都能让它尽快结束工作。 --摘抄

- 7.在某些浏览器中是有可能（但不推荐）主动触发垃圾回收。在IE中，window.CollectGarbage()方法会立即触发垃圾回收。在Opera7及更高版本中，调用window.opera.collect()也会启动垃圾回收程序。 --摘抄

- 8.将内存占用量保持在一个较小的值可以让页面性能更好。优化内存占用的最佳手段就是保证在执行代码时只保存必要的数据。如果数据不再必要，那么把它设置为null，从而释放其引用。这也可以叫作解除引用。这个建议最适合全局变量和全局对象的属性。局部变量在超出作用域后会被自动解除引用。 --摘抄

- 9.解除引用的关键在于确保相关的值已经不在上下文里了，因此它在下次垃圾回收时会被回收。 --摘抄

- 10.ES6增加这两个关键字不仅有助于改善代码风格，而且同样有助于改进垃圾回收的过程。因为const和let都是以块（而非函数）为作用域，所以相比于使用var，使用这两个新关键字可能会更早地让垃圾回收程序介入，尽早回收应该回收地内存。在块作用域比函数作用域更早终止的情况下，这就有可能发生。 --摘抄

- 11.解决方案就是避免JavaScript的“先创建再补充”式的动态属性赋值，并在构造函数中一次性声明所有属性。 --摘抄

- 12.最佳实践是把不想要的属性设置为null。这样可以保持隐藏类不变和继续共享，同时也能达到删除引用值供垃圾回收程序回收的效果。 --摘抄

>删除对象的属性的时候，先考虑能不能将这个属性设置成null，如果不可以再使用delete进行删除，使用delete可能会对性能产生影响。

- 13.JavaScript中的内存泄漏大部分是由不合理的引用导致的。 --摘抄

- 14.意外声明全局变量是最常见但也最容易修复的内存泄露问题。 --摘抄

- 15.定时器也可能会悄悄地导致内存泄漏。 --摘抄

>当排除程序崩溃的时候，需要重点排查类似于定时器这样的代码。

- 16.只要定时器一直运行，回调函数中引用的name就会一直占用内存。垃圾回收程序当然知道这一点，因而就不会清理外部变量。 --摘抄
