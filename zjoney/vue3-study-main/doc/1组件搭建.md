# Vue3ç»„ä»¶åº“æ­å»º

## ä¸€.æ­å»º`monorepo`ç¯å¢ƒ

> ä½¿ç”¨`pnpm`å®‰è£…åŒ…é€Ÿåº¦å¿«ï¼Œç£ç›˜ç©ºé—´åˆ©ç”¨ç‡é«˜æ•ˆï¼Œä½¿ç”¨`pnpm`å¯ä»¥å¿«é€Ÿå»ºç«‹`monorepo`ï¼Œso ~ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨`pnpm`Â `workspace`æ¥å®ç°`monorepo`

```js
npm install pnpm -g # å…¨å±€å®‰è£…pnpm
pnpm init  # åˆå§‹åŒ–package.jsoné…ç½®æ–‡ä»¶ ç§æœ‰åº“
pnpm install vue typescript -D # å…¨å±€ä¸‹æ·»åŠ ä¾èµ–
```

> ä½¿ç”¨`pnpm`å¿…é¡»è¦å»ºç«‹`.npmrc`æ–‡ä»¶ï¼Œ`shamefully-hoist = true`ï¼Œå¦åˆ™å®‰è£…çš„æ¨¡å—æ— æ³•æ”¾ç½®åˆ°`node_modules`ç›®å½•ä¸‹

```js
{
  "compilerOptions": {
    "module": "ESNext", // æ‰“åŒ…æ¨¡å—ç±»å‹ESNext
    "declaration": false, // é»˜è®¤ä¸è¦å£°æ˜æ–‡ä»¶ 
    "noImplicitAny": false, // æ”¯æŒç±»å‹ä¸æ ‡æ³¨å¯ä»¥é»˜è®¤any
    "removeComments": true, // åˆ é™¤æ³¨é‡Š
    "moduleResolution": "node", // æŒ‰ç…§nodeæ¨¡å—æ¥è§£æ
    "esModuleInterop": true, // æ”¯æŒes6,commonjsæ¨¡å—
    "jsx": "preserve", // jsx ä¸è½¬
    "noLib": false, // ä¸å¤„ç†ç±»åº“
    "target": "es6", // éµå¾ªes6ç‰ˆæœ¬
    "sourceMap": true,
    "lib": [ // ç¼–è¯‘æ—¶ç”¨çš„åº“
      "ESNext",
      "DOM"
    ],
    "allowSyntheticDefaultImports": true, // å…è®¸æ²¡æœ‰å¯¼å‡ºçš„æ¨¡å—ä¸­å¯¼å…¥
    "experimentalDecorators": true, // è£…é¥°å™¨è¯­æ³•
    "forceConsistentCasingInFileNames": true, // å¼ºåˆ¶åŒºåˆ†å¤§å°å†™
    "resolveJsonModule": true, // è§£æjsonæ¨¡å—
    "strict": true, // æ˜¯å¦å¯åŠ¨ä¸¥æ ¼æ¨¡å¼
    "skipLibCheck": true // è·³è¿‡ç±»åº“æ£€æµ‹
  },
  "exclude": [ // æ’é™¤æ‰å“ªäº›ç±»åº“
    "node_modules",
    "**/__tests__",
    "dist/**"
  ]
}
```


> åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å»ºç«‹`pnpm-workspace.yaml`é…ç½®æ–‡ä»¶

```js
packages:
  - 'packages/**' # å­˜æ”¾ç¼–å†™ç»„ä»¶çš„
  - docs # å­˜æ”¾æ–‡æ¡£çš„
  - play # æµ‹è¯•ç»„ä»¶çš„
```

## äºŒ.åˆ›å»ºç»„ä»¶æµ‹è¯•ç¯å¢ƒ

```js
pnpm create vite play  --template vue-ts
```

> æä¾›typescriptå£°æ˜æ–‡ä»¶Â **`typings/vue-shim.d.ts`**

```js
declare module '*.vue' {
    import type { DefineComponent } from 'vue'
    const component: DefineComponent<{}, {}, any>
    export default component
}
```

## ä¸‰.ç¼–å†™æµ‹è¯•ç»„ä»¶

```js
packages
    â”œâ”€components  # å­˜æ”¾æ‰€æœ‰çš„ç»„ä»¶
    â”œâ”€utils       # å­˜æ”¾å·¥å…·æ–¹æ³•
    â””â”€theme-chalk # å­˜æ”¾å¯¹åº”çš„æ ·å¼
```

```js
cd components && pnpm init # @zi-shui/components
cd utils && pnpm init # @zi-shui/utils
cd theme-chalk && pnpm init # @zi-shui/theme-chalk
```


> åœ¨æ ¹æ¨¡å—ä¸‹æ·»åŠ ä¾èµ–

```js
pnpm i @zi-shui/components -w
pnpm i @zi-shui/utils -w
pnpm i @zi-shui/theme-chalk -w
```



### 1).å®ç°BEMè§„èŒƒ

> **utils/create.ts**

```js
const _bem = (prefixedName, blockSuffix, element, modifier) => {
  if (blockSuffix) {
    prefixedName += `-${blockSuffix}`
  }
  if (element) {
    prefixedName += `__${element}`
  }
  if (modifier) {
    prefixedName += `--${modifier}`
  }
  return prefixedName
}
function createBEM(prefixedName: string) {
  const b = (blockSuffix = '') => _bem(prefixedName, blockSuffix, '', '')
  const e = (element = '') =>
    element ? _bem(prefixedName, '', element, '') : ''
  const m = (modifier = '') =>
    modifier ? _bem(prefixedName, '', '', modifier) : ''
  const be = (blockSuffix = '', element = '') =>
    blockSuffix && element ? _bem(prefixedName, blockSuffix, element, '') : ''
  const em = (element, modifier) =>
    element && modifier ? _bem(prefixedName, '', element, modifier) : ''
  const bm = (blockSuffix, modifier) =>
    blockSuffix && modifier ? _bem(prefixedName, blockSuffix, '', modifier) : ''
  const bem = (blockSuffix, element, modifier) =>
    blockSuffix && element && modifier
      ? _bem(prefixedName, blockSuffix, element, modifier)
      : ''
  const is = (name, state) => (state ? `is-${name}` : '')
  return {
    b,
    e,
    m,
    be,
    em,
    bm,
    bem,
    is
  }
}
export function createNamespace(name: string) {
  const prefixedName = `z-${name}`
  return createBEM(prefixedName)
}
const bem = createNamespace('button');
// z-button
// z-button-box
// z-button__element
// z-button--disabled
console.log(bem.b())
console.log(bem.b('box'))
console.log(bem.e('element'));
console.log(bem.m('disabled'))
console.log(bem.is('checked'))
console.log(bem.bem('box', 'element', 'disabled'))
```


### 2).å®ç°Iconç»„ä»¶

> iconç»„ä»¶ç¼–å†™Â **`components/icon/src/icon.ts`**

```js
import { ExtractPropTypes, PropType } from 'vue'

export const iconProps = {
  size: [Number, String] as PropType<number | string>,
  color: String
} as const
export type IconProps = ExtractPropTypes<typeof iconProps>
```

> iconç»„ä»¶ç¼–å†™Â **`components/icon/src/icon.vue`**

```js
pnpm i unplugin-vue-define-options -D # è¯†åˆ«nameå±æ€§
```

```js
<template>
    <i :class="bem.b()" :style="style">
        <slot></slot>
    </i>
</template>

<script lang="ts" setup>
import { createNamespace } from '@zi-shui/utils/create';
import { computed, CSSProperties } from 'vue';
import { iconProps } from './icon';
const bem = createNamespace('icon')
defineOptions({
    name:'ZIcon'
})
const props = defineProps(iconProps);

const style = computed<CSSProperties>(() => {
    if (!props.size && !props.color) {
        return {}
    }
    return {
        ...(props.size ? { 'font-size': props.size + 'px' } : {}),
        ...(props.color ? { 'color': props.color } : {})
    }
});
</script>
```

### 3).å¯¼å‡ºIconç»„ä»¶

> æ¯ä¸ªç»„ä»¶éƒ½éœ€è¦å¢æ·»installæ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨`utils`ä¸­å¢æ·»`withInstall.ts`

```js
import { Plugin } from "vue";
export type SFCWithInstall<T> = T & Plugin; // æ·»åŠ æ’ä»¶ç±»å‹
export function withInstall<T>(comp: T) {
    (comp as SFCWithInstall<T>).install = function (app) {
        const { name } = comp as unknown as { name: string }
        app.component(name, comp);// æ³¨å†Œå…¨å±€ç»„ä»¶
    }
    return comp as SFCWithInstall<T>;
}
```

è¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨`components`ä¸‹ä½¿ç”¨`utils`æ¨¡å—äº†ã€‚

```js
import { withInstall } from '@zi-shui/utils/withInstall';
import _Icon from './src/icon.vue';
const Icon = withInstall(_Icon); // ç”Ÿæˆå¸¦æœ‰installæ–¹æ³•çš„ç»„ä»¶
export default Icon; // å¯¼å‡ºIconç»„ä»¶
export type { IconProps } from './src/icon'
declare module 'vue' {
    export interface GlobalComponents {
        ZIcon: typeof Icon
    }
}
```

### 4).å±•ç¤ºç»„ä»¶

```js
import { createApp } from 'vue'
import App from './App.vue'
import Icon from '@zi-shui/components/icon';
const app = createApp(App);
app.use(Icon);
app.mount('#app')
```

### 5).`svg`å›¾æ ‡

> å®‰è£…`@vicons/ionicons5`ä½œä¸ºå›¾æ ‡åº“

```js
<script setup lang="ts">
import { CashOutline } from '@vicons/ionicons5'
</script>
<template>
  <ZIcon color="red" size="40">
    <CashOutline></CashOutline>
  </ZIcon>
</template>
```


## å››.scssç¼–å†™

### 1).ç»“æ„ç›®å½•

```js
theme-chalk
â”‚  â””â”€src
â”‚      â””â”€mixins 
â”‚		    â””â”€config.scss # BEMè§„èŒƒå‘½å
```

### 2).sassé…ç½®

> **`mixins/config.scss`**

```js
$namespace: 'z';
$element-separator: '__';
$modifier-separator:'--';
$state-prefix:'is-';
```

> **`mixins/mixins.scss`**

```js
@use 'config' as *;
@forward 'config';
// .z-button{}
@mixin b($block) {
    $B: $namespace+'-'+$block;
    .#{$B}{
        @content;
    }
}
// .z-button.is-xxx
@mixin when($state) {
    @at-root {
        &.#{$state-prefix + $state} {
            @content;
        }
    }
}
// &--primary => .z-button--primary
@mixin m($modifier) {
    @at-root {
        #{&+$modifier-separator+$modifier} {
            @content;
        }
    }
}
// &__header  => .z-button__header
@mixin e($element) {
    @at-root {
        #{&+$element-separator+$element} {
            @content;
        }
    }
}
```
> **`icon.scss`**

```
@use 'mixins/mixins' as *;
@include b('icon') {
  height: 1em;
  width: 1em;
  line-height: 1em;
  display: inline-block;
  vertical-align: middle;
  svg {
    height: 1em;
    width: 1em;
  }
}
```


> **`index.scss`**

```
@use './icon.scss';
```



> æœ€ååœ¨`main.ts`ä¸­å¼•å…¥æ­¤`scss`å³å¯ï¼Œè¿™é‡Œç¼–è¯‘`sass`è¿˜éœ€è¦å®‰è£…`sass`

## äº”.`Eslint`é…ç½®

> å¼€å‘é¡¹ç›®éœ€è¦å®‰è£…Â `vscode`Â æ’ä»¶Â `volar`

```
npx eslint --init
```


**æ ¡éªŒè¯­æ³•å¹¶æç¤ºé”™è¯¯è¡Œæ•°**

```
? How would you like to use ESLint? ... 
  To check syntax only
> To check syntax and find problems
  To check syntax, find problems, and enforce code style
```


**é‡‡ç”¨`js-module`**

```
? What type of modules does your project use? ... 
> JavaScript modules (import/export)
  CommonJS (require/exports)
  None of these
```


**é¡¹ç›®é‡‡ç”¨`vue`è¯­æ³•**

```
? Which framework does your project use? ... 
  React
> Vue.js
  None of these
```

**æ‰‹åŠ¨å®‰è£…æ’ä»¶**

```
pnpm i eslint-plugin-vue@latest @typescript-eslint/eslint-plugin@latest @typescript-eslint/parser@latest eslint@latest -D -w
```

> æ”¯æŒ vue ä¸­ tsÂ `eslint`é…ç½®

```
pnpm i @vue/eslint-config-typescript -D -w
```


**`.eslintrcé…ç½®`**

```
module.exports = {
    "env": {
        "browser": true,
        "es2021": true,
        "node": true
    },
    "extends": [
        "eslint:recommended",
        "plugin:vue/vue3-recommended", // vue3è§£æ https://eslint.vuejs.org/
        "plugin:@typescript-eslint/recommended",
        "@vue/typescript/recommended"
    ],
    "parserOptions": {
        "ecmaVersion": "latest",
        "parser": "@typescript-eslint/parser",
        "sourceType": "module"
    },
    "rules": {
        "vue/html-self-closing": "off",
        "vue/max-attributes-per-line": "off",
        "vue/singleline-html-element-content-newline": "off",
        "vue/multi-word-component-names": "off",
    },
    globals: {
        defineProps: "readonly"
    }
}
```


**`.eslintignore`é…ç½®**

```
node_modules
dist
*.css
*.jpg
*.jpeg
*.png
*.gif
*.d.ts
```


> æœ€ç»ˆå®‰è£…`vscode`ä¸­`eslint`æ’ä»¶ï¼š`eslint`åªæ˜¯æ£€æµ‹ä»£ç è§„èŒƒ

## å…­.Prettieré…ç½®

**`.prettierrc.js`**

```js
module.exports = {
    singleQuote: true, //ä½¿ç”¨å•å¼•å·
    semi: false, // ä½¿ç”¨åˆ†å·
    trailingComma: "none", // æœ«å°¾é€—å·
    arrowParens: "avoid", //  ç®­å¤´å‡½æ•°æ‹¬å·
    endOfLine: "auto" // ç»“å°¾æ¢è¡Œè‡ªåŠ¨
}
```


**`.prettierignore`**

```
node_modules
dist
```

> æœ€ç»ˆå®‰è£…`vscode`ä¸­`Prettier`æ’ä»¶ï¼š`prettier`åªæ˜¯ç”¨æ¥æ ¼å¼åŒ–ä»£ç 
>
> è¿™é‡Œéœ€è¦é…ç½®`Format On Save`Â ä¸ºå¯ç”¨ï¼Œä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–Â `Default Formatter`é€‰æ‹©`Prettier - Code formatter`

## ä¸ƒ.ç¼–è¾‘å™¨é…ç½®

**`.editorconfig`**

```
root = true

[*]
charset = utf-8
indent_style = space
indent_size = 2
end_of_line = lf
```

> æœ€ç»ˆå®‰è£…`vscode`ä¸­`EditorConfig for VS Code`æ’ä»¶

## å…«.lint-stagedé…ç½®

### 1).æäº¤æ£€æµ‹ä»£ç 

```
git init
pnpm install mrm husky lint-staged -w -D
npx mrm lint-staged
```


### 2).ä»£ç æäº¤æ£€æµ‹

```
pnpm install @commitlint/cli @commitlint/config-conventional -D -w
npx husky add .husky/commit-msg "npx --no-install commitlint --edit $1"
```


> `commitlint.config.jsé…ç½®`

```
module.exports = {
  extends: ["@commitlint/config-conventional"],
  rules: {
    "type-enum": [
      2,
      "always",
      [
        "build",     // ç¼–è¯‘ç›¸å…³çš„ä¿®æ”¹ï¼Œä¾‹å¦‚å‘å¸ƒç‰ˆæœ¬ã€å¯¹é¡¹ç›®æ„å»ºæˆ–è€…ä¾èµ–çš„æ”¹åŠ¨
        "chore",     // å…¶ä»–ä¿®æ”¹, æ¯”å¦‚æ”¹å˜æ„å»ºæµç¨‹ã€æˆ–è€…å¢åŠ ä¾èµ–åº“ã€å·¥å…·ç­‰
        "ci",        // æŒç»­é›†æˆä¿®æ”¹
        "docs",      // æ–‡æ¡£ä¿®æ”¹
        "feature",   //æ–°ç‰¹æ€§ã€æ–°åŠŸèƒ½
        "fix",       // ä¿®æ”¹ bug
        "perf",      // ä¼˜åŒ–ç›¸å…³ï¼Œæ¯”å¦‚æå‡æ€§èƒ½ã€ä½“éªŒ
        "refactor",  // ä»£ç é‡æ„
        "revert",    // å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
        "style",     // ä»£ç æ ¼å¼ä¿®æ”¹
        "test"       // æµ‹è¯•ç”¨ä¾‹ä¿®æ”¹
      ]
    ]
  }
}
```


> `git commit -m"feature: åˆå§‹åŒ–å·¥ç¨‹"`

## ä¹.`Vitepress`ç¼–å†™ç»„ä»¶æ–‡æ¡£

```
pnpm install vitepress -D # åœ¨docç›®å½•ä¸‹å®‰è£…
```



```
{
    "scripts": {
        "dev": "vitepress dev ." 
    }
}
```


> åœ¨æ ¹é¡¹ç›®ä¸­å¢æ·»å¯åŠ¨å‘½ä»¤

```
"docs:dev": "pnpm -C docs dev"
```



### 1).é¦–é¡µé…ç½®

```
---
layout: home

hero:
  name: z-ui ç»„ä»¶åº“
  text: åŸºäº Vue 3 çš„ç»„ä»¶åº“.
  tagline: æŒæ¡ vue3 ç»„ä»¶ç¼–å†™
  actions:
    - theme: brand
      text: å¿«é€Ÿå¼€å§‹
      link: /guide/quieStart

features:
  - icon: ğŸ› ï¸
    title: ç»„ä»¶åº“æ„å»ºæµç¨‹
    details: Vue3 ç»„ä»¶åº“æ„å»º...
  - icon: âš™ï¸
    title: ç»„ä»¶åº“å•å…ƒæµ‹è¯•
    details: Vue3 ç»„ä»¶åº“æµ‹è¯•...
---
```


### 2).æ–‡æ¡£é…ç½®æ–‡ä»¶

**`.vitepress/config.js`**

```
module.exports = {
  title: 'Z-UI',
  description: 'zi-shui UI',
  themeConfig: {
    lastUpdated: 'æœ€åæ›´æ–°æ—¶é—´',
    docsDir: 'docs',
    editLinks: true,
    editLinkText: 'ç¼–è¾‘æ­¤ç½‘ç«™',
    repo: 'https://gitee.com/login',
    footer: {
      message: 'Released under the MIT License.',
      copyright: 'Copyright Â© 2022-present Zi Shui'
    },
    nav: [
      { text: 'æŒ‡å—', link: '/guide/installation', activeMatch: '/guide/' },
      { text: 'ç»„ä»¶', link: '/component/icon', activeMatch: '/component/' }
    ],
    sidebar: {
      '/guide/': [
        {
          text: 'æŒ‡å—',
          items: [
            { text: 'å®‰è£…', link: '/guide/installation' },
            { text: 'å¿«é€Ÿå¼€å§‹', link: '/guide/quieStart' }
          ]
        }
      ],
      '/component/': [
        {
          text: 'åŸºç¡€ç»„ä»¶',
          items: [{ text: 'Icon', link: '/component/icon' }]
        }
      ]
    }
  }
}
```

### 3).ä¸»é¢˜é…ç½®

**`.vitepress/theme/index.ts`**

```
import DefaultTheme from 'vitepress/theme'
import '@zi-shui/theme-chalk/src/index.scss'
import NIcon from '@zi-shui/components/icon'

export default {
  ...DefaultTheme,
  enhanceApp({ app }) {
    app.use(NIcon); // æ³¨å†Œç»„ä»¶
  }
}
```

> æ·»åŠ `vite.config.ts`Â è®©å…¶ä¹Ÿæ”¯æŒÂ `defineOptions`

### 4).Iconç»„ä»¶ç¼–å†™

````
# Icon å›¾æ ‡

z-ui æ¨èä½¿ç”¨ xicons ä½œä¸ºå›¾æ ‡åº“ã€‚

```
$ pnpm install @vicons/ionicons5
```

## ä½¿ç”¨å›¾æ ‡

- å¦‚æœä½ æƒ³åƒç”¨ä¾‹ä¸€æ ·ç›´æ¥ä½¿ç”¨ï¼Œä½ éœ€è¦å…¨å±€æ³¨å†Œç»„ä»¶ï¼Œæ‰èƒ½å¤Ÿç›´æ¥åœ¨é¡¹ç›®é‡Œä½¿ç”¨ã€‚

<script setup lang="ts">
import { CashOutline } from '@vicons/ionicons5'
</script>
<ZIcon color="red" size="40">
  <CashOutline/>
</ZIcon>

<ZIcon color="green" size="40">
  <CashOutline/>
</ZIcon>
<ZIcon color="blue" size="40">
  <CashOutline/>
</ZIcon>
<div>

<ZIcon color="red" size="60">
  <CashOutline/>
</ZIcon>

<ZIcon color="green" size="60">
  <CashOutline/>
</ZIcon>

<ZIcon color="blue" size="60">
  <CashOutline/>
</ZIcon>
</div>

```vue
<script setup lang="ts">
import { CashOutline } from '@vicons/ionicons5'
</script>
<template>
  <ZIcon color="red" size="40">
    <CashOutline />
  </ZIcon>
</template>
```

## API

### Icon Props

| åç§°  | ç±»å‹             | é»˜è®¤å€¼    | è¯´æ˜     |
| ----- | ---------------- | --------- | -------- |
| color | string           | undefined | å›¾æ ‡é¢œè‰² |
| size  | number | string | undefined | å›¾ç‰‡å¤§å° |
````