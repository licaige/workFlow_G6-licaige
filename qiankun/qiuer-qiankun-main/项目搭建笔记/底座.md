å‚è€ƒï¼š[å¾®å‰ç«¯qiankunæ¶æ„å®æˆ˜](https://juejin.cn/post/7262982840018665532#heading-9)

# åº•åº§é¡¹ç›®
## åˆå§‹åŒ–é¡¹ç›®
ç”¨vueè„šæ‰‹æ¶åˆå§‹åŒ–é¡¹ç›®ï¼š
```bash
vue3 create base
```
åˆå§‹åŒ–é¡¹ç›®æ—¶çš„é€‰é¡¹ï¼š
```bash
Vue CLI v3.11.0
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update available: 5.0.8  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
? Please pick a preset: Manually select features
? Check the features needed for your project: Babel, Router, Vuex, CSS Pre-processors, Linter
? Use history mode for router? (Requires proper server setup for index fallback in production) Yes
? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default): Less
? Pick a linter / formatter config: Basic
? Pick additional lint features: (Press <space> to select, <a> to toggle all, <i> to invert selection)Lint on save
? Where do you prefer placing config for Babel, PostCSS, ESLint, etc.? In dedicated config files
? Save this as a preset for future projects? No
```
å®‰è£… element-ui
```bash
vue3 add element
```
å®‰è£… element-uiçš„æ—¶å€™æŠ¥é”™ï¼š
```bash
D:\dataGitMy\base>vue3 add element

ğŸ“¦  Installing vue-cli-plugin-element...

yarn add v1.22.19
[1/4] Resolving packages...
info There appears to be trouble with your network connection. Retrying...
info There appears to be trouble with your network connection. Retrying...
info There appears to be trouble with your network connection. Retrying...
info There appears to be trouble with your network connection. Retrying...
error An unexpected error occurred: "https://registry.npmjs.org/vue-cli-plugin-element: connect ETIMEDOUT 104.16.2.35:443".
info If you think this is a bug, please open a bug report with the information provided in "D:\\dataGitMy\\base\\yarn-error.log".
info Visit https://yarnpkg.com/en/docs/cli/add for documentation about this command.
 ERROR  command failed: yarn add -D vue-cli-plugin-element
```
ç„¶åæ‰§è¡Œ `yarn cache clean` æ¸…ç¼“å­˜ï¼Œå†æ‰§è¡Œ `yarn add element-ui` å®‰è£…ä¾èµ–

ä¿®æ”¹ App.vue
```vue
<template>
  <el-container style="height: 100vh; border: 1px solid #eee">
    <el-aside width="200px" style="background-color: rgb(84, 92, 100)">
      <div style="padding:10px">
        <img alt="Vue logo" src="./assets/logo.png" width="150">
      </div>
      <el-menu background-color="#545c64" text-color="#fff" active-text-color="#ffd04b" :router="true"
        :default-openeds="['1', '2', '3']">
        <el-submenu index="1">
          <template slot="title"><i class="el-icon-message"></i>ä¸»åº”ç”¨</template>
          <el-menu-item index="/">ä¸»é¡µ</el-menu-item>
        </el-submenu>
        <el-submenu index="2">
          <template slot="title"><i class="el-icon-menu"></i>Reactå­åº”ç”¨</template>
          <el-menu-item index="/react">ä¸»é¡µé¢</el-menu-item>
        </el-submenu>
        <el-submenu index="3">
          <template slot="title"><i class="el-icon-menu"></i>Vueå­åº”ç”¨</template>
          <el-menu-item index="/vue">ä¸»é¡µé¢</el-menu-item>
        </el-submenu>
        <el-submenu index="4">
          <template slot="title"><i class="el-icon-menu"></i>Vue3å­åº”ç”¨</template>
          <el-menu-item index="/vue3">ä¸»é¡µé¢</el-menu-item>
        </el-submenu>
        <el-submenu index="5">
          <template slot="title"><i class="el-icon-menu"></i>Umiå­åº”ç”¨</template>
          <el-menu-item index="/umi">ä¸»é¡µé¢</el-menu-item>
        </el-submenu>
      </el-menu>
    </el-aside>

    <el-container>
      <el-header style="text-align: right; font-size: 12px;">
        <el-dropdown>
          <i class="el-icon-setting" style="margin-right: 15px"></i>
          <el-dropdown-menu slot="dropdown">
            <el-dropdown-item>æŸ¥çœ‹</el-dropdown-item>
            <el-dropdown-item>æ–°å¢</el-dropdown-item>
            <el-dropdown-item>åˆ é™¤</el-dropdown-item>
          </el-dropdown-menu>
        </el-dropdown>
        <span>ç‹å°è™</span>
      </el-header>

      <el-main>
        <!-- ä¸»åº”ç”¨çš„æ¸²æŸ“åŒºåŸŸï¼Œç”¨äºæŒ‚è½½ä¸»åº”ç”¨è§¦å‘çš„ç»„ä»¶ -->
        <router-view v-show="$route.name"></router-view>
        <!-- å­åº”ç”¨æ¸²æŸ“çš„åŒºåŸŸï¼Œç”¨äºæŒ‚è½½Vueæˆ–è€…Reactå­åº”ç”¨èŠ‚ç‚¹ -->
        <div v-show="!$route.name" id="container"></div>
      </el-main>
    </el-container>
  </el-container>
</template>

<script>

export default {
  name: 'app',
  data() {
    const item = {
      date: '2016-05-02',
      name: 'ç‹å°è™',
      address: 'ä¸Šæµ·å¸‚æ™®é™€åŒºé‡‘æ²™æ±Ÿè·¯ 1518 å¼„'
    };
    return {
      tableData: Array(5).fill(item)
    }
  }

}
</script>

<style lang="less" scoped>
.el-header {
  background-color: #B3C0D1;
  color: #333;
  line-height: 60px;
}

.el-aside {
  color: #333;
}


</style>

```

ä¿®æ”¹é¡¹ç›®ç«¯å£: è„šæ‰‹æ¶åˆå§‹åŒ–çš„é¡¹ç›®é»˜è®¤ç«¯å£ä¸º8080ï¼Œä¸ºé˜²æ­¢åç»­å­åº”ç”¨ç«¯å£å†²çªï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰‹åŠ¨ä¿®æ”¹ç«¯å£ï¼Œåœ¨ vue.comfig.js é…ç½®ç«¯å£ä¿¡æ¯ï¼š
```js
module.exports =  {
  devServer: {
    open: true,
    port: 8081,
  }
}
```

æ‰§è¡Œ `yarn add qiankun` æˆ– `npm i qiankun -S` å®‰è£… `qiankun` æ’ä»¶
æ‰§è¡Œ `yarn add qiankun` å®‰è£…æŠ¥é”™ï¼š
```bash
error An unexpected error occurred: "https://registry.npmjs.org/qiankun: connect ETIMEDOUT 104.16.25.34:443".
```
æŸ¥çœ‹ yarn å’Œ npm çš„é•œåƒ:
```bash
yarn config get registry
https://registry.npm.taobao.org

npm config get registry 
https://registry.npmjs.org/
```
æ‰§è¡Œ `npm config set registry https://registry.npm.taobao.org` å°† npm é•œåƒæ”¹ä¸ºæ·˜å®é•œåƒï¼Œå†æ‰§è¡Œ `yarn add qiankun` æŠ¥é”™ï¼š
```bash
error An unexpected error occurred: "https://registry.npm.taobao.org/qiankun: certificate has expired".
```
æ‰§è¡Œ `yarn cache clean` æ¸…ç¼“å­˜å
å°† yarn å’Œ npm çš„é•œåƒæ”¹ä¸ºå®˜æ–¹é•œåƒ:
```bash
yarn config set registry https://registry.npmjs.org
npm config set registry https://registry.npmjs.org  
```
å†æ‰§è¡Œ `yarn add qiankun` æˆåŠŸå®‰è£…ã€‚

å¦‚æœä»»ç„¶æŠ¥é”™ï¼š
```bash
error An unexpected error occurred: "https://registry.npmjs.org/qiankun: connect ETIMEDOUT 104.16.0.35:443".
```
æ¸…ç¼“å­˜ï¼š`npm cache clean --force` å’Œ `yarn cache clean --force`



## src/qiankun/index.js
æ–°å¢ `src/qiankun/index.js`
```js
/**
 * ç”¨äºå­˜æ”¾æˆ‘ä»¬å„ä¸ªå¾®åº”ç”¨çš„æ•°ç»„ã€‚
 * ä»¥åæœ‰å¤šå°‘ä¸ªå¾®åº”ç”¨ï¼Œè¿™ä¸ªæ•°ç»„ä¸­å°±ä¼šå­˜æ”¾å¤šå°‘ä¸ªå¯¹è±¡
 */
const apps = [
  /**
   * name: å¾®åº”ç”¨åç§° - å…·æœ‰å”¯ä¸€æ€§
   * entry: å¾®åº”ç”¨å…¥å£ - é€šè¿‡è¯¥åœ°å€åŠ è½½å¾®åº”ç”¨
   * container: å¾®åº”ç”¨æŒ‚è½½èŠ‚ç‚¹ - å¾®åº”ç”¨åŠ è½½å®Œæˆåå°†æŒ‚è½½åœ¨è¯¥èŠ‚ç‚¹ä¸Š
   * activeRule: å¾®åº”ç”¨è§¦å‘çš„è·¯ç”±è§„åˆ™ - è§¦å‘è·¯ç”±è§„åˆ™åå°†åŠ è½½è¯¥å¾®åº”ç”¨
   */
];

import { message } from 'element-ui';
import {
  registerMicroApps,
  addGlobalUncaughtErrorHandler,
  start,
} from 'qiankun';

/**
 * æ³¨å†Œå¾®åº”ç”¨
 * ç¬¬ä¸€ä¸ªå‚æ•° - å¾®åº”ç”¨çš„æ³¨å†Œä¿¡æ¯
 * ç¬¬äºŒä¸ªå‚æ•° - å…¨å±€ç”Ÿå‘½å‘¨æœŸé’©å­
 */
registerMicroApps(apps, {
  // qiankun ç”Ÿå‘½å‘¨æœŸé’©å­ - å¾®åº”ç”¨åŠ è½½å‰
  beforeLoad: (app) => {
    console.log('before load', app.name);
    return Promise.resolve();
  },
  // qiankun ç”Ÿå‘½å‘¨æœŸé’©å­ - å¾®åº”ç”¨æŒ‚è½½å
  afterMount: (app) => {
    console.log('after mount', app.name);
    return Promise.resolve();
  },
});

/**
 * æ·»åŠ å…¨å±€çš„æœªæ•è·å¼‚å¸¸å¤„ç†å™¨
 */
addGlobalUncaughtErrorHandler((event) => {
  console.error(event);
  const { message: msg } = event;
  // åŠ è½½å¤±è´¥æ—¶æç¤º
  if (msg && msg.includes('died in status LOADING_SOURCE_CODE')) {
    message.error('å¾®åº”ç”¨åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥åº”ç”¨æ˜¯å¦å¯è¿è¡Œ');
  }
});

// å¯¼å‡º qiankun çš„å¯åŠ¨å‡½æ•°
export default start;

// æ‰§è¡Œ start å°±æ˜¯åœ¨å¼€å¯ä¹¾å¤æ¶æ„ã€‚

```
åœ¨ src/main.js ä¸­å¼•å…¥qiankunçš„é…ç½®
```js
import startQiankun from './qiankun/index'

// å¼€å¯ä¹¾å¤æ¶æ„
startQiankun() 
```


## è·¯ç”±
App.vueä¸­ï¼š
```vue
<el-main>
  <!-- ä¸»åº”ç”¨çš„æ¸²æŸ“åŒºåŸŸï¼Œç”¨äºæŒ‚è½½ä¸»åº”ç”¨è§¦å‘çš„ç»„ä»¶ -->
  <router-view v-show="$route.name"></router-view>
  <!-- å­åº”ç”¨æ¸²æŸ“çš„åŒºåŸŸï¼Œç”¨äºæŒ‚è½½Vueæˆ–è€…Reactå­åº”ç”¨èŠ‚ç‚¹ -->
  <div v-show="!$route.name" id="container"></div>
</el-main>
```
!!$route.name === true çš„æ—¶å€™è¡¨ç¤ºè®¿é—®çš„æ˜¯ä¸»åº”ç”¨
!!$route.name === false çš„æ—¶å€™è¡¨ç¤ºè®¿é—®çš„æ˜¯å¾®åº”ç”¨



























