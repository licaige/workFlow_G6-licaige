# Vue2

- [vue2 æºç åˆ†æ](https://github.com/woow-wu7/7-vue2-source-code-analysis)
- [vue2 çš„ä¸€äº›çŸ¥è¯†ç‚¹](https://github.com/woow-wu7/6-penetrate/blob/main/1-FRONTEND/3-VUE/1-VUE2.md)
- [vue3 å˜åŒ–](https://github.com/woow-wu7/6-penetrate/blob/main/2-FRONTEND/3-VUE/2-VUE3.md)

### (1) vue çš„ç”Ÿå‘½å‘¨æœŸ

- create åˆ›å»ºé˜¶æ®µ
  - beforeCreate ------ data å’Œ elï¼Œä¸€èˆ¬åœ¨å†™ vue æ’ä»¶æ—¶ç”¨çš„æ¯”è¾ƒå¤šï¼Œå…¶ä»–æƒ…å†µç”¨çš„æ¯”è¾ƒå°‘
    - initInjectnos(vm)
    - initState(vm) ----------- initProps initMethods initData initComputed initWatch
    - initProvider(vm)
  - created ----------- ( å®ä¾‹åˆ›å»º ) å®Œæˆï¼Œä½†æ˜¯å¹¶ ( æ²¡æœ‰æŒ‚è½½ )ï¼Œå¯ä»¥è·å– computedï¼Œwatchï¼Œmethods ç­‰ï¼Œä½†æ˜¯ä¸èƒ½è·å– $elï¼Œ$refs
- mount æŒ‚è½½é˜¶æ®µ
  - beforeMount
    - render
  - mounted ----------- å®ä¾‹è¢«æŒ‚åœ¨åè°ƒç”¨ï¼Œ( ä¸ä¿è¯æ‰€æœ‰å­ç»„ä»¶ä¹Ÿè¢«æŒ‚åœ¨å®Œæˆï¼Œéœ€è¦åœ¨è§†å›¾å…¨éƒ¨æ›´æ–°åæ‰§è¡Œæ“ä½œï¼Œä½¿ç”¨ vm.$nextTick )
- update æ›´æ–°é˜¶æ®µ
  - beforeUpdate
    - render
  - updated
- umMount å¸è½½é˜¶æ®µ
  - beforeUnmount 3.0
  - unmounted 3.0
  - æˆ–è€…æ”¹ç‰ˆä¹‹å‰çš„ 2.0ï¼šbeforeDestroy destroyed
- keep-alive ç›¸å…³
  - activated ------- keepAlive ç¼“å­˜çš„ç»„ä»¶ - æ¿€æ´»æ—¶è§¦å‘
  - deactivated ----- keepAlive ç¼“å­˜çš„ç»„ä»¶ - å¤±æ´»æ—¶è§¦å‘
- é”™è¯¯ç›¸å…³ vue3
  - errorCaptured --- åœ¨æ•è·ä¸€ä¸ªæ¥è‡ªåä»£ç»„ä»¶çš„é”™è¯¯æ—¶è¢«è°ƒç”¨

### (2) çˆ¶å­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåº

```
1. mounté˜¶æ®µ
çˆ¶ç»„ä»¶-beforeCreate
çˆ¶ç»„ä»¶-created
çˆ¶ç»„ä»¶-beforeMount
å­ç»„ä»¶-beforeCreate
å­ç»„ä»¶-created
å­ç»„ä»¶-beforeMount
å­ç»„ä»¶-mounted
çˆ¶ç»„ä»¶-mounted
æ‰©å±•:
 - é—®é¢˜: ä¸ºä»€ä¹ˆæ˜¯æ˜¯è¿™æ ·çš„é¡ºåºï¼Ÿ
 - å›ç­”:
  - 1. å› ä¸º ( å…ˆåˆ›å»ºï¼Œæ¸²æŸ“çˆ¶ç»„ä»¶ï¼Œç„¶ååœ¨çˆ¶ç»„ä»¶ä¸­æ‰§è¡Œrenderå‡½æ•°(renderå‡½æ•°åœ¨ beforeMount å’Œ mounted ä¹‹é—´ä¼šè°ƒç”¨)ï¼Œrenderæ¸²æŸ“å°±åŒ…å«äº†æ¸²æŸ“å­ç»„ä»¶ï¼Œæ‰€ä»¥å­ç»„ä»¶å…ˆæ¸²æŸ“å®Œæˆå¹¶æŒ‚åœ¨åˆ°domï¼Œå³å­ç»„ä»¶å…ˆmountedï¼Œå½“çˆ¶ç»„ä»¶renderå®Œæˆåï¼Œçˆ¶ç»„ä»¶å°±mountedäº† -- ç±»æ¯”äºå‡½æ•°è°ƒç”¨æ ˆçš„å…³ç³» )
  - 2. çˆ¶ç»„ä»¶æŒ‚è½½å®Œæ¯•è‚¯å®šæ˜¯ç­‰é‡Œé¢çš„å­ç»„ä»¶éƒ½æŒ‚è½½å®Œæ¯•åæ‰ç®—çˆ¶ç»„ä»¶æŒ‚è½½å®Œæ¯•äº†ï¼Œæ‰€ä»¥çˆ¶ç»„ä»¶çš„mountedåœ¨æœ€å
  - æ‰©å±•: åœ¨æŒ‚è½½é˜¶æ®µ: beforeMount -> render -> mounted
  - æ‰©å±•: é™¤äº† ( 1.el )å’Œ ( 2.template ) ä¼šè¢«ç¼–è¯‘æˆrenderå‡½æ•°å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ ( æ‰‹å†™renderå‡½æ•° )


2. updateé˜¶æ®µ
çˆ¶ç»„ä»¶-beforeUpdate
å­ç»„ä»¶-beforeUpdate
å­ç»„ä»¶-updated
çˆ¶ç»„ä»¶-updated

3. unmounté˜¶æ®µ
çˆ¶ç»„ä»¶-beforeUnmount/beforeDestroy
å­ç»„ä»¶-beforeUnmount/beforeDestroy
å­ç»„ä»¶-unmounted/destroyed
çˆ¶ç»„ä»¶-unmounted/destroyed


é—®é¢˜ï¼šä¸ºä»€ä¹ˆåˆ›å»ºçš„æ—¶å€™æ˜¯çˆ¶ç»„ä»¶å…ˆåˆ›å»ºï¼ŒæŒ‚è½½çš„æ—¶å€™æ˜¯å­ç»„ä»¶å…ˆæŒ‚è½½
å›ç­”ï¼š
- 1. å› ä¸º ( å…ˆåˆ›å»ºï¼Œæ¸²æŸ“çˆ¶ç»„ä»¶ï¼Œç„¶ååœ¨çˆ¶ç»„ä»¶ä¸­æ‰§è¡Œrenderå‡½æ•°ï¼Œrenderæ¸²æŸ“å°±åŒ…å«äº†æ¸²æŸ“å­ç»„ä»¶ï¼Œæ‰€ä»¥å­ç»„ä»¶å…ˆmountedï¼Œå½“çˆ¶ç»„ä»¶renderå®Œæˆåï¼Œçˆ¶ç»„ä»¶å°±mountedäº† -- ç±»æ¯”äºå‡½æ•°è°ƒç”¨æ ˆçš„å…³ç³» )
- 2. çˆ¶ç»„ä»¶æŒ‚è½½å®Œæ¯•è‚¯å®šæ˜¯ç­‰é‡Œé¢çš„å­ç»„ä»¶éƒ½æŒ‚è½½å®Œæ¯•åæ‰ç®—çˆ¶ç»„ä»¶æŒ‚è½½å®Œæ¯•äº†ï¼Œæ‰€ä»¥çˆ¶ç»„ä»¶çš„mountedåœ¨æœ€å
- 3. <Father><Child><Child><Father> å¯ä»¥ç±»æ¯”äº ( å‡½æ•°è°ƒç”¨æ ˆ ) çš„æƒ…å†µï¼Œæ‰§è¡Œå®Œchildå‡ºæ ˆï¼Œfatheræ‰ä¼šæ‰§è¡Œå®Œæ¯•å‡ºæ ˆ
```

### (3) computed

- ç‰¹ç‚¹ ( 4 ä¸ªç‰¹ç‚¹ )
  - 1. computed å£°æ˜åï¼Œåªæœ‰åœ¨ computed è¢«è®¿é—®æ—¶æ‰ä¼šå»è®¡ç®—ï¼Œ( æ¯”å¦‚åœ¨ template æ¨¡ç‰ˆä¸­è¢«è®¿é—®ï¼Œmethods ä¸­è¢«è®¿é—® )
  - 2. computed å…·æœ‰ç¼“å­˜åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä¹‹å‰æŸä¸ª computed çš„ key è¢«è®¿é—®è¿‡äº†ï¼Œä¾èµ–çš„å“åº”å¼æ•°æ®æ²¡æœ‰å˜åŒ–ï¼Œå†æ¬¡è®¿é—®ä¸ä¼šè¿›è¡Œé‡æ–°è®¡ç®—ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ä¹‹å‰è®¡ç®—å¥½çš„å€¼
  - 3. computed çš„ä¾èµ–å¿…é¡»æ˜¯å“åº”å¼æ•°æ®ï¼Œä¸ç„¶ä¾èµ–å˜åŒ–åï¼Œä¹Ÿä¸ä¼šè§¦å‘ computed é‡æ–°è®¡ç®—
  - 4. å³ä½¿ computed çš„ä¾èµ–å˜åŒ–äº†ï¼Œä½†æ˜¯ computed è®¡ç®—çš„å€¼å¹¶æ²¡æœ‰å˜åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šé‡æ–°æ¸²æŸ“
- ä¼˜ç‚¹
  - 1. å¯¹æ¯”æ¨¡ç‰ˆä¸­ç›´æ¥å†™é€»è¾‘
    - ä¸æ¨è: æ¯”å¦‚åœ¨æ¨¡ç‰ˆä¸­å†™äº†åè½¬å­—ç¬¦ä¸²çš„é€»è¾‘ï¼Œç»„ä»¶ä¸­è¿˜æœ‰å…¶ä»–åœ°æ–¹ä¹Ÿéœ€è¦åè½¬ï¼Œ`<div> {{ message.split('').reverse().join('') }} </div>`
    - æ¨è: ä»¥ä¸Šä¸èƒ½å¤ç”¨é€»è¾‘ï¼Œå¹¶ä¸”éœ€è¦åœ¨æ¨¡ç‰ˆä¸­å¤§é‡è®¡ç®—ï¼Œå¹¶ä¸”ç¼“å­˜æ•°æ®ï¼Œcomputed å°±èƒ½å¾ˆå¥½çš„è§£å†³
  - 2. å¯¹æ¯” æ–¹æ³•
    - æ–¹æ³•: æ–¹æ³•æ¯æ¬¡é‡æ¸²æŸ“éƒ½ä¼šé‡æ–°æ‰§è¡Œ
    - è®¡ç®—å±æ€§: å½“ ä¾èµ–çš„å“åº”å¼æ•°æ® æ²¡æœ‰å˜åŒ–æ—¶ï¼Œé‡æ¸²æŸ“æ˜¯ç›´æ¥ä½¿ç”¨çš„ç¼“å­˜çš„å€¼
- æºç åˆ†æ
  - [computed æºç åˆ†æ](https://juejin.cn/post/6844904184035147790)
  - [vue æºç åˆ†æä»“åº“](https://github.com/woow-wu7/7-vue2-source-code-analysis/blob/main/src/core/observer/watcher.js)

```
computedWatcher
- ä¸ä¼šç«‹å³æ±‚å€¼: this.value = this.lazy ? undefined : this.get() å³ ( this.value=undefined )
  - å› ä¸º: computedWatcherçš„lazy=true
  - è€Œ: renderWatcherï¼Œå’Œ userWatcher ä¼šç«‹å³æ±‚å€¼ï¼Œæ‰§è¡Œget
- é—®é¢˜
  - é—®é¢˜ï¼šé‚£ä»€ä¹ˆæ—¶å€™æ±‚å€¼ï¼Ÿ
  - å›ç­”ï¼šåœ¨ template ä¸­è®¿é—®åˆ°äº† computed å®šä¹‰çš„è®¡ç®—å±æ€§æ—¶ä¼šè¿›è¡Œè®¡ç®—ï¼Œè¿˜æ¯”å¦‚ ( æ¨¡ç‰ˆä¸­ï¼Œæ–¹æ³•ä¸­ä½¿ç”¨åˆ°äº†computed )ï¼Œå› ä¸ºcomputedåˆå®šä¹‰äº†å“åº”å¼ï¼Œè®¿é—®äº†computedå±æ€§å°±ä¼šæ‰§è¡Œcomputedçš„getæ–¹æ³•ï¼Œåœ¨getæ–¹æ³•ä¸­ä¼šæ‰§è¡Œ watcher.evaluate() æ–¹æ³•ï¼Œåœ¨é‡Œé¢å°±æ˜¯å»æ‰§è¡Œ get()ï¼Œä»è€Œå»è®¡ç®—computedçš„ç»“æœ
  - åŸç†ï¼š
    - å› ä¸º: åœ¨new Watcheræ˜¯computed watcheræ—¶ï¼Œå³lazy=trueæ—¶ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­æ²¡æœ‰ç«‹å³æ‰§è¡Œget()æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨è®¡ç®—å±æ€§è¢«è®¿é—®æ—¶è§¦å‘computedçš„å“åº”å¼getåï¼Œæ‰§è¡Œçš„getæ–¹æ³•ä¸­ä¼šå»è°ƒç”¨computed getterå‡½æ•°
    - è¿‡ç¨‹: å› ä¸ºcomputedåˆå§‹åŒ–æ—¶ï¼Œä¼šåœ¨ defineComputed() å‡½æ•°ä¸­è¿›è¡Œ Object.defineProperty(target, key, sharedPropertyDefinition)ï¼Œå³get/setä¾èµ–æ”¶é›†å’Œæ´¾å‘æ›´æ–°
    - æœ€ç»ˆï¼šæ‰§è¡Œ watcher.evaluate() --> watcher.get() --> watcher.getter.call(vm, vm) --> expOrFn() --> å°±æ˜¯computedå¯¹è±¡keyå¯¹åº”çš„æ–¹æ³•
- é—®é¢˜
  - é—®é¢˜: ä¾èµ–æ²¡å˜ï¼Œcomputedä¼šç¼“å­˜ï¼Œé‚£ä¾èµ–å˜åŒ–ï¼Œä¸ºä»€ä¹ˆcomputedä¼šé‡æ–°è®¡ç®—ï¼Ÿ
  - å›ç­”: å› ä¸ºå½“computedè®¡ç®—å®Œæˆåï¼Œä¼šå°† dirty=false, åœ¨æ¬¡è®¿é—®ä¸ä¼šåœ¨è®¡ç®—ï¼Œå½“ä¾èµ–çš„å“åº”å¼æ•°æ®å˜åŒ–åï¼Œdirty=trueï¼ŒğŸˆ¶ï¸ä¼šæ‰§è¡Œ watcher.evaluate() -> watcher.get() -> åˆä¼šè¿›è¡Œè®¡ç®—
- computedçš„ç‰¹ç‚¹
  - 1. computedåªæœ‰åœ¨ ( è¢«è®¿é—®æ—¶ ) æ‰ä¼šå»è¿›è¡Œè®¡ç®—ï¼Œä¸Šé¢å·²ç»åˆ†æè¿‡äº†
  - 2. computedè®¡ç®—å±æ€§å…·æœ‰ ( ç¼“å­˜åŠŸèƒ½ )ï¼Œä¹‹å‰è®¿é—®è¿‡çš„å€¼ï¼Œå†æ¬¡è®¿é—®ï¼Œä¸ä¼šé‡æ–°è®¡ç®—ï¼Œè€Œæ˜¯è¿”å›ä¹‹å‰ç¼“å­˜çš„è®¡ç®—å¥½çš„å€¼
  - 3. computedçš„ä¾èµ–å¿…é¡»æ˜¯ ( å“åº”å¼æ•°æ® )ï¼Œä¸ç„¶ä¾èµ–æ›´æ–°ï¼Œä¹Ÿä¸ä¼šé‡æ–°è®¡ç®—
  - 4. computedçš„ä¾èµ–é¡¹æ˜¯å“åº”å¼æ•°æ®å¹¶ä¸”å˜åŒ–äº†ï¼Œä½†æ˜¯å¦‚æœ ( è®¡ç®—çš„ç»“æœä¸å˜ )ï¼Œåº”ç”¨ä¹Ÿ ( ä¸ä¼šé‡æ–°æ¸²æŸ“ )
- ç›¸å…³åŸç†åŠåˆ†æåœ°å€
  - https:juejin.cn/post/6844904184035147790
  (1) computedåªæœ‰åœ¨è¢«è®¿é—®æ—¶æ‰ä¼šé‡æ–°è®¡ç®—
    - å› ä¸ºï¼šåœ¨new Watcheræ˜¯computed watcheræ—¶ï¼Œå³lazy=trueæ—¶ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­æ²¡æœ‰ç«‹å³æ‰§è¡Œget()æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨è®¡ç®—å±æ€§è¢«è®¿é—®æ—¶è§¦å‘computedçš„å“åº”å¼getåï¼Œæ‰§è¡Œçš„getæ–¹æ³•ä¸­ä¼šå»è°ƒç”¨computed getterå‡½æ•°
    - ä¹‹å‰ï¼šä¸Šé¢å·²ç»åˆ†æè¿‡äº†
  (2) computedå…·æœ‰ç¼“å­˜åŠŸèƒ½
    - è¡¨ç°ï¼šè¡¨ç°ä¸ºå¦‚æœcomputedä¸­çš„keyè¢«è®¿é—®è¿‡ï¼Œä¸‹æ¬¡åœ¨è®¿é—®ä¸ä¼šå†é‡æ–°è®¡ç®—ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ä¹‹å‰è®¡ç®—å¥½çš„å€¼
    - åŸç†ï¼š
      - dirty=trueï¼Œè¿›è¡Œ watcher.evaluate() æ‰§è¡Œcomputedçš„keyå¯¹åº”çš„å‡½æ•°å¾—åˆ°è®¡ç®—è§£ç»“æœ
      - watcher.evaluate() è®¡ç®—åˆ°ç»“æœåï¼Œåˆä¼šå°† dirty=false
      - ä¸‹æ¬¡å†è®¿é—®åˆ°computedçš„keyæ—¶ï¼Œä¸ä¼šé‡æ–°è¿›è¡Œ watcher.evaluate() çš„è®¡ç®—ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ä¹‹å‰è®¡ç®—å¥½çš„ç»“æœï¼Œä¹‹å‰çš„å€¼å·²ç»ç¼“å­˜åœ¨watcher.valueä¸­
```

### (4) watch

- watch å¯¹è±¡çš„ key å¯¹åº”çš„ value çš„ç±»å‹
  - function --- è¡¨ç¤º key å˜åŒ–æ—¶æ‰§è¡Œçš„å‡½æ•°
  - string ----- è¡¨ç¤º ( æ–¹æ³•å ) æˆ– ('a.b' è¿™æ ·çš„ data å¯¹è±¡ä¸­çš„å±æ€§ ) -> data.a å¯¹è±¡ .b å±æ€§
  - object ----- å¯¹è±¡ä¸­ä¸€å®šè¦æœ‰ handler æ–¹æ³•ï¼Œ{ handler, immediate, deep, sync }
  - array ------ ä»¥ä¸Šçš„ç»„åˆ
  - æœ€ç»ˆéƒ½ä¼šæŠŠä¸åŒç±»å‹çš„ handler è½¬æ¢æˆå‡½æ•°ï¼Œç„¶åæ‰§è¡Œ vm.$watch(expOrFn, handler, options)
  - å®˜ç½‘è¯´æ˜ï¼šhttps://v2.cn.vuejs.org/v2/api/#watch
- watch å¯¹è±¡çš„ value æ˜¯å¯¹è±¡æ—¶ï¼Œæ”¯æŒçš„å±æ€§
  - handler: watch çš„å›è°ƒå‡½æ•°ï¼Œå‚æ•°æ˜¯ newValue, oldValue
  - deepï¼šè¡¨ç¤ºæ·±åº¦ç›‘å¬
  - immediateï¼šè¡¨ç¤ºç«‹å³æ‰§è¡Œ callbackï¼Œä¸ç”¨ç­‰åˆ° key å˜åŒ–æ—¶æ‰å»æ‰§è¡Œï¼Œ( key éœ€è¦æ˜¯å“åº”å¼æ•°æ®ï¼Œæ¯”å¦‚ dataï¼Œcomputed )
  - syncï¼šè¡¨ç¤º ( åŒæ­¥ watch å¯¹è±¡ä¸­çš„ handler å…ˆæ‰§è¡Œ )ï¼Œ( æ™®é€šçš„ watch å¯¹è±¡çš„ handler åæ‰§è¡Œ )
- **å¯ä»¥ watch å“ªäº›ç±»å‹çš„æ•°æ®ï¼Ÿ**
  - data ä¸­çš„æ•°æ®
  - computed ä¸­çš„æ•°æ®
- **watch æ³¨æ„ç‚¹**
  - é‡åˆ°é—®é¢˜: **å½“ watch çš„å€¼æ˜¯ä¸€ä¸ªåµŒå¥—çš„å¯¹è±¡æ—¶ï¼Œä¿®æ”¹å¯¹è±¡çš„å±æ€§ï¼Œwatch çš„å›è°ƒæ˜¯ä¸ä¼šæ‰§è¡Œçš„**
  - å¦‚ä½•è§£å†³:
    - 1. å¯ä»¥ä½¿ç”¨ watch çš„å¯¹è±¡æ¨¡å¼ï¼Œå¹¶è®¾ç½® deep:true
    - 2. åœ¨è®¾ç½® watch å¯¹è±¡çš„ key æ—¶ï¼Œç›´æ¥ a.b.c å–åˆ°éœ€è¦æ”¹å˜çš„å±æ€§
  - æ‰©å±•: **data çš„å“åº”å¼ä¸å—åµŒå¥—å¯¹è±¡æ·±åº¦çš„å½±å“ï¼Œå³åµŒå¥—å¤šæ·±ä¿®æ”¹æœ€é‡Œå±‚çš„å±æ€§éƒ½ä¼šè§¦å‘å“åº”å¼**
  - ä¾‹å­: æœ¬é¡¹ç›®/2-FRONTEND/3-VUE/6-watch-deep.html

```
watch æ³¨æ„ç‚¹
---

data() {
  return {
    obj: {
      obj2: {
        age: 10,
      },
    },
  };
},
watch: {
  "obj.obj2.age": function () { console.log(111); }, // --- ageå˜åŒ–ï¼Œwatchå›è°ƒä¼šæ‰§è¡Œ
  "obj.obj2": {
    handler: function () { console.log(222); }, // -------- ageå˜åŒ–ï¼Œwatchå›è°ƒä¸ä¼šæ‰§è¡Œ
  },
  "obj.obj2": {
    handler: function () { console.log(333); }, // -------- ageå˜åŒ–ï¼Œwatchå›è°ƒä¼šæ‰§è¡Œï¼Œå› ä¸ºè®¾ç½®äº† deep: true
    deep: true
  }
}
```

### (5) nextTick

```
nextTick
- this.$nextTick()
- Vue.nextTick()
---

1. ä½œç”¨
  - åœ¨ä¸‹æ¬¡DOMæ›´æ–°å¾ªç¯ç»“æŸåï¼Œæ‰§è¡Œå»¶æ—¶å›è°ƒ
  - åœ¨ ( ä¿®æ”¹æ•°æ® ) åï¼Œç«‹å³ä½¿ç”¨ nextTick è·å– ( æ›´æ–°åçš„DOM )
  - å½“ä½ åœ¨ Vue ä¸­æ›´æ”¹å“åº”å¼çŠ¶æ€æ—¶ï¼Œæœ€ç»ˆçš„ DOM æ›´æ–°å¹¶ä¸æ˜¯åŒæ­¥ç”Ÿæ•ˆçš„ï¼Œè€Œæ˜¯ç”± Vue å°†å®ƒä»¬ç¼“å­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªâ€œtickâ€æ‰ä¸€èµ·æ‰§è¡Œï¼Œè¿™æ ·æ˜¯ä¸ºäº†ç¡®ä¿æ¯ä¸ªç»„ä»¶æ— è®ºå‘ç”Ÿå¤šå°‘çŠ¶æ€æ”¹å˜ï¼Œéƒ½ä»…æ‰§è¡Œä¸€æ¬¡æ›´æ–°
2. åŸç†
  - åˆ©ç”¨ä» å¾®ä»»åŠ¡ åˆ° å®ä»»åŠ¡ çš„é€æ¸é™çº§
  - promise -> mutationObserver -> setImmediate -> setTimeout
  - æ‰©å±•
    - å¾®ä»»åŠ¡
      - promise
      - process.nextTick
      - mutationObserver - è§‚å¯ŸDOMèŠ‚ç‚¹çš„å˜åŒ–
    - å®ä»»åŠ¡
      - setTimeout
      - setInterval
      - setImmediate
      - requestAnimationFrame å¸§åŠ¨ç”» ( ç²¾ç¡®ï¼Œæµç•…ï¼Œtabéšè—å°±å›ç»“æŸ )
3. ä½¿ç”¨
  - 1. ä¼ å…¥å‚æ•°å›è°ƒï¼Œåœ¨å‚æ•°å›è°ƒä¸­è·å–æœ€æ–°çš„DOM ------------ å‚æ•°å›è°ƒ
  - 2. è¿”å›ä¸€ä¸ªpromiseï¼Œå¯ä»¥é€šè¿‡thençš„æ–¹å¼è·å–æœ€æ–°çš„DOM --- promise
  - 3. å¯ä»¥ä½¿ç”¨ async å‡½æ•°åšåŒ…è£… ----------------------- vue3ä¸­å¯ä»¥ä½¿ç”¨async
  - Vue.nextTick(function () { // DOM æ›´æ–°äº† })
  - Vue.nextTick().then(function () { // DOM æ›´æ–°äº† })
  - methods: { async increment() { await nextTick() // DOM æ­¤æ—¶å·²ç»æ›´æ–° } }
4. æ¡ˆåˆ—
  - https://github.com/woow-wu7/vue2-research/blob/master/src/views/Loading.vue
5. å®˜ç½‘è¯´æ˜
  - https://cn.vuejs.org/api/general.html#nexttick
```

### (6) Object.defineProperty çš„ç¼ºç‚¹

```
Object.defineProperty çš„ç¼ºç‚¹
---

å¯¹è±¡
- é—®é¢˜ï¼šæ·»åŠ å’Œåˆ é™¤å±æ€§ï¼Œä¸ä¼šå“åº”å¼ï¼Œåªä¼šåœ¨ä¿®æ”¹å±æ€§æ—¶æ‰ä¼šå“åº”å¼
- è§£å†³ï¼š
  - Vue.set()
  - vm.$set()

æ•°ç»„
- é—®é¢˜
  - ä¸‹æ ‡ä¿®æ”¹ï¼šé€šè¿‡ æ•°ç»„ä¸‹æ ‡ ä¿®æ”¹æ•°ç»„æˆå‘˜çš„å€¼ï¼Œä¸ä¼šå“åº”å¼
  - é•¿åº¦ï¼šä¿®æ”¹æ•°ç»„é•¿åº¦æ—¶ï¼Œä¸ä¼šå“åº”å¼
- è§£å†³
  - Vue.set()
  - vm.$set()
  - åˆ©ç”¨ vue é‡å†™çš„ 7 ç§æ•°ç»„æ–¹æ³• ( è¿™7ç§æ–¹æ³•éƒ½ä¼šæ”¹å˜åŸæ•°ç»„ )ï¼Œç„¶åæ‰‹åŠ¨çš„å¤„è§¦å‘å“åº”å¼
    - push pop unshift shift splice
    - sort reverse
```

### (6) keep-alive çš„åŸç†

- keep-alive æ˜¯å†…ç½®çš„ ( æŠ½è±¡ç»„ä»¶ )
- æŠ½è±¡ç»„ä»¶çš„ç‰¹ç‚¹ï¼š( 2 ä¸ªç‰¹ç‚¹ )
  - 1. è‡ªèº«ä¸ä¼šæ¸²æŸ“æˆ DOM å…ƒç´ ï¼Œå³ä¸å æ® DOM å…ƒç´ 
  - 2. ä¸åœ¨çˆ¶ç»„ä»¶é“¾ä¸­ï¼Œå³æŠ½è±¡ç»„ä»¶çš„ ( çˆ¶ç»„ä»¶ ) å’Œ ( å­ç»„ä»¶ ) ç›´æ¥å½¢æˆçˆ¶å­å…³ç³»
- props
  - include
  - exclude
  - max
- ç”Ÿå‘½å‘¨æœŸ
  - activated
  - deactivated
- ç¼“å­˜ç­–ç•¥
  - LRU
  - latest recently used æœ€è¿‘æœ€å°‘ä½¿ç”¨
- æºç 
  - src/core/components/keep-alive.js
- æ‰©å±•: å¸¸è§çš„ç¼“å­˜ç­–ç•¥
  - LRU æœ€è¿‘æœ€å°‘ä½¿ç”¨ - å¼ºè°ƒè®¿é—®æ—¶é—´
  - LFU æœ€ä¸ç»å¸¸ä½¿ç”¨ - å¼ºè°ƒè®¿é—®æ¬¡æ•°
  - FIFO å…ˆè¿›å…ˆå‡º
  - è¯¦æƒ…: æœ¬é¡¹ç›®/1-FRONTEND/1-JS/BB-å¸¸è§çš„ç¼“å­˜ç­–ç•¥/1-å¸¸è§ç¼“å­˜ç­–ç•¥.md
  - é“¾æ¥: [å¸¸è§çš„ç¼“å­˜ç­–ç•¥](https://github.com/woow-wu7/6-penetrate/blob/main/2-FRONTEND/JS/20-%E5%B8%B8%E8%A7%81%E7%9A%84%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5/%E5%B8%B8%E8%A7%81%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5.md)

### (7) diff ç®—æ³•

- `æ€»æµç¨‹ï¼šelæˆ–template --> AST+optimize+generate --> render() --> createElementç”Ÿæˆvnode --> vm.$update --> patch --> diff --> ç”ŸæˆçœŸå®çš„DOM`
- åˆ†ç±»ï¼štreeDiff componentDiff elementDiff
- æ€»ä½“ï¼š**é€å±‚æ¯”è¾ƒï¼Œæ·±åº¦ä¼˜å…ˆéå†**
  - 1. èŠ‚ç‚¹æ˜¯ç»„ä»¶ï¼Œèµ° componentDiff
       - åˆ¤æ–­ç»„ä»¶ç±»å‹æ˜¯å¦ä¸€æ ·ï¼Œæ ¹æ®ç»„ä»¶åç§°å’Œç»„ä»¶ç±»å‹åˆ¤æ–­
         - ç±»å‹ä¸€æ ·ï¼ŒæŒ‰åŸç­–ç•¥é€å±‚æ¯”è¾ƒ
         - ç±»å‹ä¸ä¸€æ ·ï¼Œè„ç»„ä»¶ï¼Œæš´åŠ›åˆ é™¤
  - 2. èŠ‚ç‚¹æ˜¯å…ƒç´ èŠ‚ç‚¹ï¼Œèµ° elementDiff
       - æ·»åŠ ï¼Œåˆ é™¤ï¼Œç§»åŠ¨
  - 3. å…·ä½“æ¯”è¾ƒç»†èŠ‚
       - åˆ¤æ–­ newVnode å’Œ oldVnode æ˜¯å¦æ˜¯ ( åŒä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ )ï¼Œå³ ( key å’Œ tag éƒ½è¦ç›¸åŒ )
         - ä¸æ˜¯åŒä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ ---> æš´åŠ›æ’å…¥æ–°èŠ‚ç‚¹ï¼Œåˆ é™¤æ—§èŠ‚ç‚¹
         - æ˜¯åŒä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹
         - (1) åˆ¤æ–­ newVnode å’Œ oldVnode æ˜¯å¦æ˜¯åŒä¸€ä¸ª ( å†…å­˜ä¸­çš„å¯¹è±¡ )
           - æ˜¯ ---> ä¸åšä»»ä½•æ“ä½œ
           - ä¸æ˜¯ -> ç»§ç»­å¾€ä¸‹æ‰§è¡Œ(2)
         - (2) newVnode å’Œ oldVnode éƒ½åªæœ‰ text å±æ€§
           - text ç›¸åŒ ---> ä¸åšä»»ä½•æ“ä½œ
           - text ä¸ç›¸åŒ -> ç›´æ¥ä¿®æ”¹ DOM ä¸º newVnode çš„ text
         - (3) newVnode åªæœ‰ childrenï¼ŒoldVnode åªæœ‰ text
           - 1. å°† newVnode çš„ children æ’å…¥åˆ° oldVnode å¯¹åº”çš„çœŸå® DOM çš„ å‰é¢
           - 2. åŒæ—¶ åˆ é™¤ oldVnode å¯¹åº”çš„ DOM ä¸­çš„ text
         - (4) newVnode å’Œ oldVnode éƒ½æœ‰ children
           - å››ä¸ªæŒ‡é’ˆ + é€’å½’
           - 1. æ–°å‰ä¸æ—§å‰æ¯”è¾ƒ -----> å‘½ä¸­-æŒ‡é’ˆåç§»ï¼ŒæŒ‰ä¸Šé¢çš„ç­–ç•¥è¿›è¡Œ patchï¼Œæ²¡å‘½ä¸­å¾€ä¸‹èµ°ï¼Œæ‰§è¡Œ(2)
           - 2. æ–°åä¸æ—§åæ¯”è¾ƒ -----> å‘½ä¸­-æŒ‡é’ˆå‰ç§»ï¼ŒæŒ‰ä¸Šé¢çš„ç­–ç•¥è¿›è¡Œ patchï¼Œæ²¡å‘½ä¸­å¾€ä¸‹èµ°ï¼Œæ‰§è¡Œ(3)
           - 3. æ–°åä¸æ—§å‰æ¯”è¾ƒ -----> å‘½ä¸­-æ—§å‰æŒ‡é’ˆåç§»åŠ¨ï¼Œæ–°åæŒ‡é’ˆå‰ç§»ï¼Œéœ€è¦ç§»åŠ¨èŠ‚ç‚¹ï¼ŒæŠŠ ( æ–°å‰ ) ç§»åŠ¨åˆ° ( æ—§åä¹‹å )ï¼›æ²¡å‘½ä¸­å¾€ä¸‹èµ°ï¼Œæ‰§è¡Œ(4)
           - 4. æ–°å‰ä¸æ—§åæ¯”è¾ƒ -----> å‘½ä¸­-æ–°å‰æŒ‡é’ˆåç§»ï¼Œæ—§åæŒ‡é’ˆå‰ç§»ï¼Œéœ€è¦ç§»åŠ¨èŠ‚ç‚¹ï¼ŒæŠŠ ( æ–°å‰ ) ç§»åŠ¨åˆ° ( æ—§å‰ä¹‹å‰ )
           - æŒ‡é’ˆï¼šå‰å¾€åç§»ï¼Œåå¾€å‰ç§»

### (8) ç”¨ index ä½œä¸º key çš„ç¼ºç‚¹

- key çš„ä½œç”¨ï¼šç”¨äº diff ç®—æ³•ä¸­çš„å”¯ä¸€æ ‡è®°
- index ä½œç”¨ä¸º key çš„ç¼ºç‚¹ï¼š
  - æè¿°ï¼šæ¯”å¦‚å½“æ¸²æŸ“ list ä¸º 3 ä¸ª input æ¡†ï¼Œåœ¨æ¯ä¸ª input æ¡†ä¸­è¾“å…¥ 123ï¼Œå½“æˆ‘ä»¬åˆ é™¤ 2 æ—¶ï¼Œæ­¤æ—¶ 3 çš„ input æ¡†ä¼šå˜æˆ 2
  - åŸå› ï¼šå› ä¸ºåˆ é™¤ 2 åï¼ŒåŸæ¥ 3 çš„ index å˜æˆäº† 2ï¼Œ(key) å’Œ (css é€‰æ‹©å™¨ input) éƒ½æ²¡å˜ï¼Œè®¤ä¸ºè¿˜æ˜¯ä¹‹å‰çš„ 2
- æ€»ç»“
  - åœ¨ é™æ€åˆ—è¡¨ ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ index ä½œä¸º key
  - å† åŠ¨æ€åˆ—è¡¨ ä¸­ï¼Œä¸èƒ½ä½¿ç”¨ index ä½œä¸º keyï¼ŒåŸå› å¦‚ä¸Š
- vueï¼šæœ¬é¡¹ç›®/test-vue/key/test-key.html
- reactï¼šhttps://juejin.cn/post/7029703494877577246

### (9) vue style æ ‡ç­¾ä¸­çš„ scoped çš„ä½œç”¨

- `ç»“åˆ (17) æ¥ä¸€èµ·çœ‹`
- scoped
  - æ˜¯ html5 æ–°å¢åŠ çš„å±æ€§
  - æ˜¯ä¸€ä¸ª boolean å€¼ï¼Œè¡¨ç¤º ( åˆ™æ ·å¼ä»…ä»…åº”ç”¨åˆ° style å…ƒç´ çš„ - çˆ¶å…ƒç´ åŠå…¶å­å…ƒç´  )
- vue ä¸­çš„ scoped
  - ä½œç”¨ï¼šæ ·å¼åªä½œç”¨äºè¯¥ç»„ä»¶ï¼Œå’Œå…¶ä»–ç»„ä»¶å³ä½¿æ˜¯åŒä¸€ä¸ª class ç±»åï¼Œä¹Ÿäº’ä¸å½±å“
  - åŸç†ï¼š
    - é€šè¿‡ç»™ ( HTML å…ƒç´ èŠ‚ç‚¹æ·»åŠ å”¯ä¸€çš„å±æ€§ )ï¼Œç„¶åé€šè¿‡ ( css å±æ€§é€‰æ‹©å™¨ ) é€‰ä¸­è¯¥èŠ‚ç‚¹
    - 1. åœ¨ html çš„ css é€‰æ‹©å™¨å¯¹åº”çš„æ ‡ç­¾èŠ‚ç‚¹ä¸­ï¼Œæ·»åŠ è‡ªå®šä¹‰å±æ€§ ( data-v-hash å€¼ )
    - 2. åœ¨ css é€‰æ‹©å™¨ - æ·»åŠ  ( **å±æ€§é€‰æ‹©å™¨** ) - ( a[data-v-hash å€¼] )
    - 3. è¿™æ ·å°±å¯ä»¥é€‰ä¸­å”¯ä¸€çš„ ( ç±» class çš„é€‰ä¸­çš„èŠ‚ç‚¹ - å¹¶ä¸”å±æ€§æ˜¯ data-v-hash å€¼çš„ ) èŠ‚ç‚¹
- æ‰©å±•
  - **css é€‰æ‹©å™¨çš„æƒé‡**
  - !important > å†…è”(è¡Œå†…)æ ·å¼ > id > ( class ç±», ä¼ªç±», å±æ€§é€‰æ‹©å™¨ ) > ( æ ‡ç­¾å…ƒç´ é€‰æ‹©å™¨ï¼Œä¼ªå…ƒç´ é€‰æ‹©å™¨ ) > ( é€šé…ç¬¦é€‰æ‹©å™¨ï¼Œå…³ç³»å‹é€‰æ‹©å™¨ )
- æ‰©å±•
  - vue ä¸­ï¼Œå½“çˆ¶å­ç»„ä»¶éƒ½æ·»åŠ äº† scoped æ—¶ï¼Œå¦‚ä½•åœ¨çˆ¶ç»„ä»¶ä¸­ä¿®æ”¹å­ç»„ä»¶çš„æ ·å¼ï¼Ÿ- æ·±åº¦é€‰æ‹©å™¨
  - è¯¦è§: 17
- æ¡ˆä¾‹

```
<template>
  <div class="loading">
</template>
<style scoped>
  .loading {
    border: 2px solid blue;
  }
</style>


1. htmlå¤„ç†ä¸º
- æ·»åŠ è‡ªå®šä¹‰å±æ€§ data-v-hash å€¼
<div data-v-ffa58c1c class="loading">

2. csså¤„ç†ä¸º
- å±æ€§é€‰æ‹©å™¨ .loading[data-v-hashå€¼]
.loading[data-v-ffa58c1c] {
  border: 2px solid blue;
}
```

### (10) vue2 ä¸­ v-if å’Œ v-for çš„ä¼˜å…ˆçº§

- **æ³¨æ„ï¼šåœ¨ vue3 ä¸­ä¿®æ”¹äº†ä¼˜å…ˆçº§é¡ºåºï¼Œv-if > v-for äº†ï¼Œæ‰€ä»¥ä¸èƒ½å†™åœ¨åŒä¸€ä¸ªæ ‡ç­¾ä¸Šï¼Œä½†æ— è®º vue3 è¿˜æ˜¯ vue2 éƒ½ä¸è¦æŠŠ v-if å’Œ v-for å†™åœ¨åŒä¸€ä¸ªå…ƒç´ ä¸Š**ï¼Œ
- é—®é¢˜
  - é—®é¢˜: ä¸ºä»€ä¹ˆä¸è¦æŠŠ v-for å’Œ v-if å†™åœ¨åŒä¸€ä¸ªå…ƒç´ ä¸Šï¼Ÿ
  - å›ç­”: å› ä¸º vue2 æºç ä¸­æ˜¯å…ˆéå†åœ¨è¿›è¡Œåˆ¤æ–­ï¼Œå³ä½¿æˆ‘ä»¬åªæ¸²æŸ“åˆ—è¡¨ä¸­ä¸€å°éƒ¨åˆ†å…ƒç´ ï¼Œå½“ v-if æ”¹å˜å€¼ï¼Œå¯¼è‡´é‡æ¸²æŸ“çš„æ—¶ï¼Œå°±ä¼šéå†æ•´ä¸ªåˆ—è¡¨ï¼Œè¿™ä¼šæ¯”è¾ƒæµªè´¹
  - æ‰©å±•: vue3 ä¸­åˆ™å®Œå…¨ç›¸åï¼Œv-if çš„ä¼˜å…ˆçº§é«˜äº v-forï¼Œå®ƒè°ƒç”¨çš„å˜é‡è¿˜ä¸å­˜åœ¨ï¼Œå°±ä¼šå¯¼è‡´å¼‚å¸¸ï¼Œ
  - å¦‚ä½•è§£å†³: 1.å°† v-if æå‡åˆ°å¤–éƒ¨ 2.è®¡ç®—å±æ€§ï¼Œè¿‡æ»¤ååœ¨æ¸²æŸ“
- å¤„ç†æ—¶æœº
  - ( v-if,v-for ) æŒ‡ä»¤çš„å¤„ç†å‘ç”Ÿåœ¨ ( æ¨¡ç‰ˆç¼–è¯‘é˜¶æ®µ )
- ä¼˜å…ˆçº§
  - vue2: å½“ v-if å’Œ v-for ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œä¼˜å…ˆçº§ ( v-for > v-if )
  - vue3: v-if > v-for
  - åŸå› 
    - å› ä¸º
      - åœ¨æºç ä¸­ï¼Œåœ¨è¿›è¡Œ if åˆ¤æ–­çš„æ—¶å€™ï¼Œv-for æ˜¯æ¯” v-if å…ˆè¿›è¡Œåˆ¤æ–­çš„
      - æ–‡ä»¶ä½ç½®ï¼šsrc/compiler/codegen/index.js
    - ( æ¨¡ç‰ˆ template ) æœ€ç»ˆä¼šè¢«ç¼–è¯‘ä¸º ( render å‡½æ•° )
      - v-for åœ¨ç¼–è¯‘æ—¶ä¼šè¢«ç¼–è¯‘æˆ ( \_l å‡½æ•° )ï¼Œå³ renderList æ–¹æ³•
      - v-if åœ¨ç¼–è¯‘æ—¶ä¼šè¢«ç¼–è¯‘æˆ ( ä¸‰å…ƒè¡¨è¾¾å¼ )ï¼›ä¸å‘½ä¸­çš„æƒ…å†µä¼šåˆ›å»ºä¸€ä¸ªç©ºçš„ vnode å³ ( æ²¡æœ‰æ–‡æœ¬çš„æ³¨é‡ŠèŠ‚ç‚¹ )
  - å…·ä½“è¢«ç¼–è¯‘ç»“æœå¦‚ä¸‹

```
1. template
<div>
	<div v-for="value in [1,2]" v-if="true"></div>
</div>


2. ç¼–è¯‘ç»“æœ
- å…ˆv-forç”Ÿæˆæ¯ä¸ªèŠ‚ç‚¹ï¼Œåœ¨é€šè¿‡v-ifè¿›è¡Œåˆ¤æ–­
function render() {
  with(this) {
    return _c('div', _l(([1, 2]), function (value) {
      return (true) ? _c('div') : _e()
    }), 0)
  }
}

3. ç¼–è¯‘ç½‘ç«™
https://v2.template-explorer.vuejs.org/

4. æ‰©å±•
v-if å’Œ v-show çš„åŒºåˆ«
v-if ---> ç¼–è¯‘é˜¶æ®µï¼Œæ§åˆ¶æ˜¯å¦æ¸²æŸ“
v-show -> è¿è¡Œæ—¶é˜¶æ®µï¼Œæ§åˆ¶æ ·å¼ï¼Œç›¸å½“äºè¯¥å…ƒç´  ( é»˜è®¤çš„display ) å’Œ ( display:none ) ä¹‹é—´åˆ‡æ¢
```

- é¿å…ï¼šé¿å…åœ¨åŒä¸€å…ƒç´ ä¸ŠåŒæ—¶ä½¿ç”¨ v-for å’Œ v-if
- è§£å†³ï¼š
  - 1. å¦‚æœæ˜¯å¯¹åˆ—è¡¨è¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨ ( è®¡ç®—å±æ€§ ) å°†è¦æ¸²æŸ“çš„èŠ‚ç‚¹è¿‡æ»¤åï¼Œåœ¨äº¤ç»™ ( v-for ) å»æ¸²æŸ“
  - 2. å¦‚æœæ˜¯å®‰æ¡ä»¶æ¸²æŸ“ï¼Œå¯ä»¥å°† ( v-if æé«˜åˆ°å®¹å™¨å…ƒç´ ä¸Š )ï¼Œåœ¨å®¹å™¨å…ƒç´ å†…éƒ¨å†ä½¿ç”¨ ( v-for )
  - å®˜ç½‘ï¼šhttps://cn.vuejs.org/v2/style-guide/#%E9%81%BF%E5%85%8D-v-if-%E5%92%8C-v-for-%E7%94%A8%E5%9C%A8%E4%B8%80%E8%B5%B7%E5%BF%85%E8%A6%81
- èµ„æ–™
  - https://juejin.cn/post/6844904183619944462
  - https://juejin.cn/post/6941995130144587789
- v-for
  - å¯ä»¥éå† ( æ•°ç»„ï¼Œå¯¹è±¡ï¼Œå­—ç¬¦ä¸²ï¼Œæ•°å­—, Iterate æ¥å£çš„æ•°æ® )
  - Array | Object | number | string | Iterable (2.6 æ–°å¢)
  - v-for æºç ä½ç½®ï¼šæœ¬é¡¹ç›®/src/core/instance/render-helpers/render-list.js
- æ¡ˆä¾‹
  - æœ¬é¡¹ç›®/test-vue/v-if+v-show/vIf-vShow.html

### (11) template -> render ç¼–è¯‘çš„è¿‡ç¨‹

- æ¨¡ç‰ˆç¼–è¯‘åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šparse è§£æé˜¶æ®µï¼Œoptimize ä¼˜åŒ–é˜¶æ®µï¼Œgenerate ä»£ç ç”Ÿæˆé˜¶æ®µ
- 1. parse
  - è§£æé˜¶æ®µ
  - å°† template è½¬æˆ AST
  - é€šè¿‡ ( æ ˆ ) æ¥ä¿è¯ ( æ ‘å½¢ç»“æ„ )
- 2. optimize
  - ä¼˜åŒ–é˜¶æ®µ
  - å¯¹ ( é™æ€èŠ‚ç‚¹ å’Œ é™æ€æ ¹èŠ‚ç‚¹ ) åšä¼˜åŒ–
    - é—®é¢˜ï¼š
      - é—®é¢˜ï¼šä»€ä¹ˆæ˜¯é™æ€èŠ‚ç‚¹å’Œé™æ€æ ¹èŠ‚ç‚¹ï¼Ÿ
      - å›ç­”ï¼š
        - é™æ€èŠ‚ç‚¹ï¼šæœ‰ä¸€ç§èŠ‚ç‚¹ï¼Œåœ¨é¦–æ¬¡æ¸²æŸ“åï¼Œæ— è®ºçŠ¶æ€æ€ä¹ˆæ”¹å˜ï¼Œå®ƒéƒ½ä¸ä¼šå˜çš„èŠ‚ç‚¹å« ( é™æ€èŠ‚ç‚¹ )ï¼Œ( é™æ€èŠ‚ç‚¹åªåŒ…å«çº¯æ–‡æœ¬ï¼Œä¸åŒ…å«ä»»ä½•å˜é‡ )
        - é™æ€æ ¹èŠ‚ç‚¹ï¼šå°±æ˜¯æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯é™æ€èŠ‚ç‚¹çš„ ( çˆ¶èŠ‚ç‚¹ )
    - é—®é¢˜ï¼š
      - é—®é¢˜ï¼šå¦‚ä½•è¯†åˆ« é™æ€èŠ‚ç‚¹ ï¼Ÿ
      - å›ç­”ï¼šå¦‚æœä¸€ä¸ª dom å…ƒç´ æ ‡ç­¾ä¸­ï¼Œåªå«æœ‰çº¯æ–‡æœ¬ï¼Œè€Œä¸å«ä»»ä½•å˜é‡ï¼Œå³ä¸º ( é™æ€èŠ‚ç‚¹ )
  - å¦‚ä½•ä¼˜åŒ–
    - æ•´ä¸ªè¿‡ç¨‹ï¼štemplate(HTML) -> AST -> render -> Vnode -> patch ( diff å¯¹æ¯”+ç”ŸæˆçœŸå® DOM )
    - å…·ä½“ä¼˜åŒ–ï¼š
      - å› ä¸º ( é™æ€èŠ‚ç‚¹å’Œé™æ€æ ¹èŠ‚ ) ç‚¹ä¸ä¼šå˜åŒ–ï¼Œæ‰€ä»¥æ˜¯ ( ä¸éœ€è¦åš diff ç®—æ³•æ¯”å¯¹ ) çš„ï¼Œæ‰€ä»¥ä¸åš diffï¼Œæå‡æ€§èƒ½
      - å…·ä½“å°±æ˜¯ä¸¤ç‚¹
        - 1. åœ¨ AST ä¸­æ‰¾å‡ºæ‰€æœ‰é™æ€èŠ‚ç‚¹å¹¶æ‰“ä¸Šæ ‡è®°ï¼›
        - 2. åœ¨ AST ä¸­æ‰¾å‡ºæ‰€æœ‰é™æ€æ ¹èŠ‚ç‚¹å¹¶æ‰“ä¸Šæ ‡è®°ï¼›
  - æ‰©å±•
    - é—®é¢˜ï¼šreact ä¸­æœ‰ shouldComponentUpdateï¼Œä¸ºä»€ä¹ˆ vue ä¸­ä¸éœ€è¦
    - å›ç­”ï¼š
      - å› ä¸º vue æ˜¯åŸºäº ( æ¨¡ç‰ˆ )ï¼Œå³åœ¨ ( æ¨¡ç‰ˆç¼–è¯‘é˜¶æ®µ ) å°±çŸ¥é“å“ªäº›èŠ‚ç‚¹ä¸éœ€è¦åš diff ç®—æ³•æ¯”å¯¹ï¼Œå› ä¸ºé™æ€èŠ‚ç‚¹å’Œé™æ€æ ¹èŠ‚ç‚¹ä¸éœ€è¦åš diff ç®—æ³•
      - å³æ¨¡ç‰ˆç¼–è¯‘èŠ‚ç‚¹çš„ optimize é˜¶æ®µè¦åšçš„äº‹æƒ…
  - æ‰©å±•
    - patchFlag: vue3 å¯¹åŠ¨æ€èŠ‚ç‚¹åšäº†ä¼˜åŒ–ï¼Œåš pathFlag æ ‡è®°åŠ¨æ€èŠ‚ç‚¹ï¼Œæ›´æ–°ç»„ä»¶ template ä¸­çš„åŠ¨æ€èŠ‚ç‚¹éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯çœŸä¸ªç»„ä»¶ä¸€èµ·æ›´æ–°
    - è¿æ¥: NOTE/VUE3.md
- 3. generate
  - ä»£ç ç”Ÿæˆé˜¶æ®µ
  - ä¸»è¦åšçš„äº‹æƒ…ï¼š
    - ç”Ÿæˆ render å‡½æ•°ï¼Œä¾›ç»„ä»¶åœ¨æŒ‚è½½æ—¶è°ƒç”¨
    - å³ ( AST -> render )
  - render å‡½æ•°æœ‰å‡ ç§ï¼Ÿä¸¤ç§
    - ä¸€ç§æ˜¯ï¼šæ‰‹å†™ render å‡½æ•°æ—¶ï¼Œç›´æ¥è°ƒç”¨æ‰‹å†™çš„ render
    - å¦ä¸€ç§ï¼šå¦‚æœæ²¡æœ‰æ‰‹å†™çš„ renderï¼Œå°±ä¼šæŠŠ template ç¼–è¯‘æˆ render
  - å…·ä½“è¿‡ç¨‹
    - é€’å½’
    - ä»é¡¶å‘ä¸‹ä¾æ¬¡é€’å½’ AST ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ ¹æ® ( ä¸åŒçš„ AST èŠ‚ç‚¹ç±»å‹ ) åˆ›å»º ( ä¸åŒçš„ VNode ç±»å‹ )

### (12) äº‹ä»¶ä¿®é¥°ç¬¦çš„åŸç†

- å¸¸è§çš„äº‹ä»¶ä¿®é¥°ç¬¦
  - stop ---------- é˜»æ­¢ä¼ æ’­ï¼Œç›¸å½“äº event.stopPropagation
  - prevent ------- é˜»æ­¢é»˜è®¤ï¼Œç›¸å½“äº event.preventDefault
  - capture ------- åœ¨æ•è·é˜¶æ®µè§¦å‘
  - once ---------- åªè§¦å‘ä¸€æ¬¡
  - passive ------- ä¸ä¼šé˜»æ­¢ event.preventDefault
  - self ---------- ( ç»‘å®šäº‹ä»¶çš„èŠ‚ç‚¹ ) å’Œ ( äº‹ä»¶è§¦å‘çš„èŠ‚ç‚¹ ) è¦æ˜¯ ( åŒä¸€ä¸ªèŠ‚ç‚¹ ) æ‰ä¼šè§¦å‘
  - left ---------- é¼ æ ‡å·¦é”®è§¦å‘
  - right
  - middle

```
1
addEventListener
target.addEventListener(type, listener|å…·æœ‰handleEventæ–¹æ³•çš„å¯¹è±¡[, useCaptureï½œ{capture,once,passive}]);

2
ç»‘å®šäº‹ä»¶çš„ä¸‰ç§æ–¹æ³•
- HTMLä¸­é€šè¿‡ ( onClick="è¦æ‰§è¡Œçš„ä»£ç " )
- jsä¸­é€šè¿‡ DOMèŠ‚ç‚¹.onclick=function(){}
- jsä¸­é€šè¿‡ DOMèŠ‚ç‚¹.addEventListener('click', listener, useCapture)
- ä¼˜ç¼ºç‚¹
  - HTML
    - HTMLæ ‡ç­¾ä¸­ä½¿ç”¨ä½¿ç”¨ ( on+äº‹ä»¶å="éœ€è¦æ‰§è¡Œçš„ä»£ç " )
    - 1. åªèƒ½åœ¨ ( å†’æ³¡é˜¶æ®µ ) è§¦å‘
    - 2. è¿åäº† HTML å’Œ JS åˆ†ç¦»çš„åŸåˆ™
  - äº‹ä»¶å±æ€§
    - 1. åªèƒ½åœ¨ ( å†’æ³¡é˜¶æ®µ ) è§¦å‘
    - 2. åŒä¸€ä¸ªäº‹ä»¶ï¼Œåªèƒ½ç»‘å®š ( ä¸€ä¸ªç›‘å¬å‡½æ•° )ï¼Œä¸èƒ½ç»‘å®šå¤šä¸ª
  - addEventListener
    - 1. èƒ½æŒ‡å®šäº‹ä»¶è§¦å‘çš„é˜¶æ®µï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å¯¹è±¡æ—¶ï¼Œé€šè¿‡ capture æŒ‡å®šæ˜¯å¦åœ¨æ•è·é˜¶æ®µè§¦å‘ï¼Œfalseåˆ™åœ¨å†’æ³¡é˜¶æ®µè§¦å‘
    - 2. åŒä¸€ä¸ªäº‹ä»¶å¯ä»¥ç»‘å®šå¤šä¸ªç›‘å¬å‡½æ•°
  - æ€»ç»“
    - æ¨èä½¿ç”¨ addEventListener

3
äº‹ä»¶ä¿®é¥°ç¬¦çš„åŸç†
- ä¸»è¦ä¾é ï¼š( æ¨¡ç‰ˆç¼–è¯‘ ) åŸç†ï¼Œå³åœ¨æ¨¡ç‰ˆç¼–è¯‘æ—¶åšç›¸å…³å¤„ç†
- 1. prevent stop åœ¨ ( æ¨¡ç‰ˆç¼–è¯‘ ) æ—¶ï¼Œä¼šç›´æ¥åœ¨ ( äº‹ä»¶ç›‘å¬å‡½æ•° ) ä¸­æ·»åŠ  event.preventDefault å’Œ event.stopPropagation
- 2. captureï¼Œonceï¼Œpassive åœ¨ ( æ¨¡ç‰ˆç¼–è¯‘ ) æ—¶ï¼Œä¼šåœ¨ ( äº‹ä»¶åå‰ ) å¢åŠ  ( æ ‡è¯†~!& )
  - capture ------> !
  - once ---------> ~
  - passive ------> &
  - å…·ä½“
    - html -------> <div @click.stop.prevent.once.capture></div> )
    - render -----> function render() { with(this) { return _c('div', [_c('div', { on: { "~!click": function ($event) {} } })]) } }
- 3. é”®ç›˜äº‹ä»¶åŒç†
```

### (13) $attrs å’Œ $listeners å’Œ $slots/$scopedSlots

- vm.$attrs
  - åŒ…å«ï¼šæ²¡æœ‰åœ¨ ( props ) ä¸­å£°æ˜çš„ ( attribute ) å±æ€§ï¼Œ( æ¯”å¦‚ä¼ å…¥äº† 3 ä¸ªå±æ€§ï¼Œè€Œå­ç»„ä»¶ä¸­ props åªå£°æ˜äº†ä¸€ä¸ªå±æ€§ï¼Œåˆ™å¦å¤–ä¸¤ä¸ªåœ¨ $attrs ä¸­ )
  - ä¸åŒ…å«ï¼šstyle å’Œ class
  - ä¼ å…¥ç»„ä»¶å†…éƒ¨ï¼šå¯ä»¥é€šè¿‡ v-bind="$attrs" ä¼ å…¥å†…éƒ¨ç»„ä»¶â€”â€”åœ¨åˆ›å»ºé«˜çº§åˆ«çš„ç»„ä»¶æ—¶éå¸¸æœ‰ç”¨
  - æ¡ˆä¾‹ï¼šæœ¬é¡¹ç›®/test-vue/$attrs/$attrs-$listeners.html
- vm.$listeners
  - åŒ…å«ï¼šäº†çˆ¶ä½œç”¨åŸŸä¸­çš„ v-on äº‹ä»¶ç›‘å¬å™¨
  - ä¸åŒ…å«ï¼š(ä¸å« .native ä¿®é¥°å™¨çš„) v-on äº‹ä»¶ç›‘å¬å™¨
  - ä¼ å…¥ç»„ä»¶å†…éƒ¨ï¼šå¯ä»¥é€šè¿‡ v-on="$listeners" ä¼ å…¥å†…éƒ¨ç»„ä»¶â€”â€”åœ¨åˆ›å»ºæ›´é«˜å±‚æ¬¡çš„ç»„ä»¶æ—¶éå¸¸æœ‰ç”¨
  - æ¡ˆä¾‹ï¼šæœ¬é¡¹ç›®/test-vue/$attrs/$attrs-$listeners.html
- æ³¨æ„ç‚¹ï¼š
  - å¦‚æœ ( äº‹ä»¶ ) æ˜¯é€šè¿‡ ( v-bind ) çš„æ–¹å¼ä¼ é€’ï¼Œä»ç„¶æ˜¯ä¸€ä¸ª ( å±æ€§ )ï¼Œèµ° props å’Œ $attrs
  - å¦‚æœ ( äº‹ä»¶ ) æ˜¯é€šè¿‡ ( v-on ) çš„æ–¹å¼ä¼ é€’ï¼Œæ‰ä¼šèµ° $listeners
- æ‰©å±•
  - é—®é¢˜ï¼švue ä¼ é€’æ•°æ®çš„æ–¹å¼
  - å›ç­”ï¼š
    - props $attrs $listeners $slots $scopedSlots
    - vm.$emit
    - provide/inject -------- ä¸ä¿è¯æ˜¯å“åº”å¼çš„
    - vuex router
    - eventbus æ•°æ®æ€»çº¿ï¼Œæ¯”å¦‚åŸå‹é“¾ç»§æ‰¿
    - $parent --------------- çˆ¶å®ä¾‹ - ( ä¾‹å­:æœ¬é¡¹ç›®/test-vue/test-$parent-$children.html )
    - $children ------------- å½“å‰å®ä¾‹çš„ç›´æ¥å­ç»„ä»¶(æ•°ç»„) - (æ•°ç»„ä¸­çš„ç›´æ¥å­ç»„ä»¶)ä¸èƒ½ä¿è¯é¡ºåºï¼Œä¸æ˜¯å“åº”å¼ - ( æ³¨æ„åœ¨vue3ä¸­$children å·²ç»è¢«åˆ é™¤ï¼Œå¯ä»¥ç”¨ Template Refs è·å– )

### (14) ä¸ºä»€ä¹ˆå¤§ Vue ä¸ä½¿ç”¨ class è€Œæ˜¯ä½¿ç”¨æ„é€ å‡½æ•°å‘¢ï¼Ÿ

- å› ä¸º vue å¯ä»¥æŠŠä¸åŒçš„æ–¹æ³•æŒ‚è½½åŸå‹é“¾ä¸Šï¼ŒæŠŠå®ç°ä»£ç å•ç‹¬æŠ½ç¦»æˆæ–‡ä»¶ï¼Œæ–¹ä¾¿ç®¡ç†
- è€Œ class çš„è¯ï¼Œæ‰€æœ‰éé™æ€å±æ€§(åŸå‹å±æ€§)éƒ½å¿…é¡»åœ¨ class å†…éƒ¨å£°æ˜ï¼Œä¸åˆ©äºå¤§å‹å·¥ç¨‹æ–‡ä»¶ç®¡ç†

### (15) æ‰‹å†™ v-model åŒå‘æ•°æ®ç»‘å®š

- è¯¦è§ï¼šæœ¬é¡¹ç›®/test-vue/v-model/handwrite-v-model.html

### (16) ç¯å¢ƒå˜é‡

- è¯¦è§ 1
  - (5) ç¯å¢ƒå˜é‡
  - https://github.com/woow-wu7/8-divine
- æ¡ˆä¾‹
  - https://github.com/woow-wu7/4-joyo-lingjing-h5/blob/main/.env

### (17) vue ä¸­ï¼Œå½“çˆ¶å­ç»„ä»¶éƒ½æ·»åŠ äº† scoped æ—¶ï¼Œå¦‚ä½•åœ¨çˆ¶ç»„ä»¶ä¸­ä¿®æ”¹å­ç»„ä»¶çš„æ ·å¼ï¼Ÿ- æ·±åº¦é€‰æ‹©å™¨

- `ç»“åˆ (9) æ¥ä¸€èµ·çœ‹`
- å…³é”®è¯ï¼š
  - ( >>> ) ( /deep/ ) ( ::v-deep ) ( :deep(){} )
  - scoped
- æ‰©å±•é—®é¢˜ï¼švue ä¸­ scoped çš„åŸç†ï¼Œè¯¦è§ (9)

```
vueä¸­ï¼Œå½“çˆ¶å­ç»„ä»¶éƒ½æ·»åŠ äº†scopedæ—¶ï¼Œå¦‚ä½•åœ¨çˆ¶ç»„ä»¶ä¸­ä¿®æ”¹å­ç»„ä»¶çš„æ ·å¼ï¼Ÿ- æ·±åº¦é€‰æ‹©å™¨
---
1
é—®é¢˜æè¿°
- å› ä¸º
  - 1. åœ¨vueç»„ä»¶ä¸­styleé€šè¿‡ ( scoped ) å¯ä»¥åœ¨ ( æœ¬ç»„ä»¶çš„æ‰€æœ‰å…ƒç´ ä¸Šæ·»åŠ  data-v-hash è‡ªå®šä¹‰å±æ€§ )
  - 2. å½“ çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶ éƒ½æ·»åŠ äº† scoped æ—¶
    - ä¸¤ä¸ª: å­ç»„ä»¶çš„ ( æ ¹å…ƒç´  ) ä¸Šä¼šæœ‰ ( ä¸¤ä¸ª ) data-v-hashï¼Œä¸€ä¸ªæ˜¯è‡ªå·±çš„ï¼Œä¸€ä¸ªæ˜¯çˆ¶ç»„ä»¶çš„
    - ä¸€ä¸ª: å­ç»„ä»¶çš„ ( å…¶ä»–å…ƒç´  ) ä¸Šåªæœ‰ ( ä¸€ä¸ª ) data-v-hashï¼Œæ˜¯è‡ªå·±çš„
- æ‰€ä»¥
  - åœ¨çˆ¶å­ç»„ä»¶éƒ½æ·»åŠ äº†scopedæ—¶ï¼Œçˆ¶ç»„ä»¶å°±ä¸èƒ½é€šè¿‡ ( classç±»å )ï¼Œæ¥é€‰ä¸­ ( å­ç»„ä»¶é™¤äº†æ ¹å…ƒç´ ä»¥å¤–çš„å…¶ä»–å…ƒç´  )ï¼Œå› ä¸º hash ä¸ä¸€æ ·
- å¦‚ä½•è§£å†³
  - 1. é€šè¿‡ >>> /deep/ ::v-deep :deep() æ¥è§£å†³ ------- æ¨èä½¿ç”¨ :deep(cssé€‰æ‹©å™¨) {}
  - 2. åœ¨vueæ–‡ä»¶ä¸­ï¼Œå†æ·»åŠ ä¸€ä¸ªä¸å¸¦ scoped çš„ style æ ‡ç­¾
---
(1) deep
- è¡¨ç°
  - css æ˜¯ >>>
  - scss æ˜¯ /deep/
  - scss æ˜¯ ::v-deep -------------------------------- æ³¨æ„ï¼šè¿™ç§å†™æ³•å·²ç»è¢«å¼ƒç”¨ï¼Œä½¿ç”¨ :deep(){} ä»£æ›¿
  - scss æ˜¯ :deep(){}
- å†™æ³•
  - å†™æ³•ä¸Šä¸€å…±æœ‰ 4 ç§å†™æ³•
  - æ¨èä½¿ç”¨ :deep(){} çš„æ–¹å¼

<!-- å†™æ³•4 ä½¿ç”¨:deep(<inner-selector>) -->
<style lang="scss" scoped>
  :deep(.ant-card-head-title){
    background: yellowgreen;
  }
</style>

<!-- å†™æ³•1 ä½¿ç”¨::v-deep -->
<style lang="scss" scoped>
  ::v-deep .ant-card-head-title{
    background: yellowgreen;
  }
</style>

<!-- å†™æ³•2 ä½¿ç”¨>>> æ“ä½œç¬¦-->
<style scoped>
>>>.ant-card-head-title{
  background: yellowgreen;
}
</style>

<!-- å†™æ³•3 ä½¿ç”¨/deep/ -->
<style scoped>
 /deep/.ant-card-head-title{
  background: yellowgreen;
}
</style>
---

(2) åœ¨vueæ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ä¸å¸¦ scope çš„ style
```

### (18) è™šæ‹Ÿ DOM çš„ä¼˜ç¼ºç‚¹ï¼Ÿ

- ä¼˜ç‚¹
  - è·¨å¹³å° ( node å’Œæµè§ˆå™¨ä¸­éƒ½å¯ä»¥ï¼Œnode ä¸­æ²¡æœ‰çœŸå®çš„ DOMï¼Œä¾¿äºå®ç°æœåŠ¡ç«¯æ¸²æŸ“ç­‰ )
  - ä¿è¯æ€§èƒ½ä¸‹é™
  - æ— éœ€æ‰‹åŠ¨æ“ä½œ DOM
- ç¼ºç‚¹
  - æ— æ³•è¿›è¡Œæè‡´ä¼˜åŒ–

### (19) provide å’Œ inject çš„åŸç†ï¼Ÿ

- [é“¾æ¥-vue2 æºç åˆ†æ-provide å’Œ inject](https://github.com/woow-wu7/7-vue2-source-code-analysis/blob/main/src/core/instance/inject.js#L18:17)
- [é“¾æ¥-èµ„æ–™](http://www.kangchangyi.com/article/Vue/provide%E3%80%81inject%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86.html#%E5%8E%9F%E7%90%86)
- [vue2 å®˜ç½‘](https://v2.cn.vuejs.org/v2/api/#provide-inject)
- [vue3 å®˜ç½‘](https://cn.vuejs.org/api/options-composition.html#inject)

```
provide å’Œ inject åŸç†è§£æ
---

1. åœ¨ option æ¯ä¸ªç»„ä»¶é…ç½®ä¸­å¯ä»¥å£°æ˜ provide é€‰é¡¹å¯¹è±¡
    - keyæ˜¯è¦ä¼ å…¥injectä¸­å¯¹åº”çš„key
    - valueæ˜¯å¯ä»¥è¢«injectè·å–çš„å€¼
2. åœ¨åˆå§‹åŒ–æ—¶ï¼ŒVue ä¼šåœ¨æ¯ä¸ª vm æŒ‚è½½ _provided å¯¹è±¡ï¼Œå³ vm._provided
    - keyå’Œvalueéƒ½å’Œprovideä¸­çš„ä¸€ä¸€å¯¹åº”
3. åœ¨åˆå§‹åŒ–æ—¶ï¼ŒVue ä¼šéå†ç»„ä»¶ä¸­çš„ inject (æ•°ç»„æˆ–å¯¹è±¡) ä¸­çš„ keyï¼Œä¼šå»å½“å‰ç»„ä»¶çˆ¶ç»„ä»¶çš„ vm._provided æ‰¾
    - æ‰¾åˆ°ï¼Œç›´æ¥è¿”å›
    - æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™é€šè¿‡ vm.$parent ç»§ç»­å¾€ä¸Šæ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°æ ¹ç»„ä»¶ä¸ºæ­¢
      - æ‰¾åˆ°åå°†å€¼è¿”å›ä½œä¸ºinjectçš„è¿”å›å€¼
      - æ²¡æœ‰æ‰¾åˆ°åˆ™ä½¿ç”¨é»˜è®¤å€¼ä½œä¸ºinjectçš„è¿”å›å€¼
```

```
provide å’Œ inject æ³¨æ„ç‚¹
---

é‡åˆ°é—®é¢˜: provideå’Œinjectå¹¶ä¸ä¿è¯å“åº”å¼
è§£å†³æ–¹æ¡ˆ: provideçš„å±æ€§å€¼ç”¨ computed è¿›è¡ŒåŒ…è£…
å®˜ç½‘è¯´æ˜: https://cn.vuejs.org/guide/components/provide-inject.html#working-with-reactivity
```

### (20) v-model å’Œ .sync çš„åŒºåˆ«ï¼Ÿ

- v-model
  - ç›¸å½“äº <my-component :value="value" @input="value = $event.target.value" >
- .sync
  - ç›¸å½“äº <my-component :value="msg" @update:value="(val) => value = val" >
- ä¸¤è€…çš„åŒºåˆ«
  - v-model ä¸»è¦ç”¨äº inputï¼Œtextareaï¼Œå¹¶ä¸”ä¸€ä¸ªç»„ä»¶åªèƒ½æœ‰ä¸€ä¸ª v-model
  - .sync ä¸€ä¸ªç»„ä»¶å¯ä»¥æœ‰å¤šä¸ª .sync
- èµ„æ–™
  - https://juejin.cn/post/6943488981703065614
  - vue3 ä¸­ä½¿ç”¨ v-model https://www.jianshu.com/p/df114269d751
  - vue2 å®˜ç½‘ https://v2.cn.vuejs.org/v2/guide/components-custom-events.html#sync-%E4%BF%AE%E9%A5%B0%E7%AC%A6
  - vue3 ä¸­æœ‰å˜åŒ–

### (21) v-permission è‡ªå®šä¹‰æŒ‡ä»¤å®ç°

- é“¾æ¥: https://github.com/woow-wu7/6-penetrate/blob/main/2-FRONTEND/VUE/v-permission-directive.html

### (22) vue2 ä¸­å¸¸è§çš„æŒ‡ä»¤ æœ‰å“ªäº›ï¼Ÿ

```
v-for
v-if
v-show

v-on
v-bind

v-model
v-slot

v-text
v-html

v-once
```

### (23) Vue.observable

- [å®˜ç½‘é“¾æ¥](https://v2.cn.vuejs.org/v2/api/?#Vue-observable)
- **Vue.observable(object)**
- ä½œç”¨
  - 1. è®©ä¸€ä¸ª ( å¯¹è±¡ ) å¯å“åº”ï¼Œå³ ( æŠŠæ™®é€šå¯¹è±¡ è½¬æˆ å“åº”æ˜¯å¯¹è±¡ )
  - 2. è¿”å›çš„å¯¹è±¡å¯ä»¥ç›´æ¥ç”¨äº ( æ¸²æŸ“å‡½æ•° ) å’Œ ( è®¡ç®—å±æ€§ ) å†…ï¼Œå¹¶ä¸”ä¼šåœ¨å‘ç”Ÿå˜æ›´æ—¶è§¦å‘ç›¸åº”çš„æ›´æ–°ã€‚ä¹Ÿå¯ä»¥ä½œä¸ºæœ€å°åŒ–çš„è·¨ç»„ä»¶çŠ¶æ€å­˜å‚¨å™¨
- åº”ç”¨
  - VUE: **Vue.observable** å¯ä»¥å®ç°ç±»ä¼¼ vuex çš„åŠŸèƒ½ï¼ŒèŒƒå›´æ¯” **vuex** å°
  - REACT: ç±»ä¼¼ react ä¸­é€šè¿‡ **createContext + useContext + useReducer** å®ç°ä¸€ä¸ª **redux** ç±»ä¼¼
- æ¡ˆä¾‹
  - æœ¬é¡¹ç›®/2-FRONTEND/3-VUE/5-Vue.observable().html

```
<body>
  <div id="app">
    <div>
      <button @click="add">count++</button>
      <div>{{countNumber}}</div>
    </div>
    <Child></Child>
  </div>
  <script>
    // Vue.observable(object)
    // - 1. è®©ä¸€ä¸ª ( å¯¹è±¡ ) å¯å“åº”ï¼Œå³ ( æŠŠæ™®é€šå¯¹è±¡ è½¬æˆ å“åº”æ˜¯å¯¹è±¡ )
    // - 2.  è¿”å›çš„å¯¹è±¡å¯ä»¥ç›´æ¥ç”¨äº ( æ¸²æŸ“å‡½æ•° ) å’Œ ( è®¡ç®—å±æ€§ ) å†…ï¼Œå¹¶ä¸”ä¼šåœ¨å‘ç”Ÿå˜æ›´æ—¶è§¦å‘ç›¸åº”çš„æ›´æ–°ã€‚ä¹Ÿå¯ä»¥ä½œä¸ºæœ€å°åŒ–çš„è·¨ç»„ä»¶çŠ¶æ€å­˜å‚¨å™¨

    // Vue.observable
    const state = Vue.observable({
      count: 1,
    });

    // mixin
    // - åœ¨ çˆ¶å­ç»„ä»¶ ä¸­éƒ½å…·æœ‰è¯¥ computed
    Vue.mixin({
      computed: {
        countNumber() {
          return state.count;
        },
      },
    });

    // component
    const Child = Vue.component("A", {
      template: "<div>Child Component {{countNumber}}</div>",
    });

    new Vue({
      el: "#app",
      components: {
        Child,
      },
      methods: {
        add() {
          state.count++;
        },
      },
    });
  </script>
</body>
```

### (23) æ’æ§½ slot

- å…·åæ’æ§½
- ä½œç”¨åŸŸæ’æ§½
- å…·åä½œç”¨åŸŸæ’æ§½

```
1
ç»„ä»¶å£°æ˜
<div class="container">
  <main>
    <slot name="default" :count="1" :text="1"></slot>
  </main>
  <footer>
    <slot name="footer" :text="2"></slot>
  </footer>
</div>

---
2
ç»„ä»¶è°ƒç”¨
- 1. #default: æ˜¯ v-slot:default="defaultProps" çš„ç®€å†™
- 2. è§£æ„: <MyComponent v-slot="{ text, count }"> {{ text }} {{ count }} </MyComponent>
<MyComponent>
  <template #default="defaultProps">
    {{ defaultProps }}
  </template>
  <template #footer="footerProps">
    {{ footerProps }}
  </template>
</MyComponent>
```

# ç›¸å…³é“¾æ¥

- https:github.com/woow-wu7/7-vue2-source-code-analysis/blob/main/src/core/observer/watcher.js
