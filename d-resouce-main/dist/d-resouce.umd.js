!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).dResouce={})}(this,function(e){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(r.key),r)}}function l(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var n;if(e)return"string"==typeof e?r(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,t){return!(!e||e===document)&&(e===t||n(e.parentNode,t))}function c(e,t){var i=t.endFuc,a=t.excFuc,n=e.createReader();(function r(){n.readEntries(function(n){(function e(t){return n[t]||0!==t?n[t]?void a(n[t],{next:function(){e(t+1)}}):r():i()})(0)})})()}function a(e,t){return[].slice.call(e).map(function(e){return t?t(e):{file:e,fullPath:e.name,name:e.name,size:e.size,type:e.type}})}function u(t,e){var n,r=e.getSize,i=void 0===r?null:r,e=void 0===(r=e.path)?"":r;return t.child?(n=0,t.fullPath=e+t.name,t.file=new File([],t.fullPath,{type:"text/directory"}),t.child.forEach(function(e){n+=u(e,{getSize:i,path:t.fullPath+"/"})}),t.totalSize=n):(t.fullPath=e+t.name,t.size=t.file.size,i?i(t):t.size||0)}function t(e){return Math.pow(1024,e)}function o(){}var s={Array:"array",Tree:"tree"},f={stop:"stop",filter:"filter"},d=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.targetDom=e.targetDom,this.dragoverFuc=e.dragoverFuc||o,this.dragleaveFuc=e.dragleaveFuc||o,this.beforeReadFuc=e.beforeReadFuc,this.readDataFuc=e.readDataFuc||o,this.validFuc=e.validFuc,this.filterFuc=e.filterFuc,this.mode=e.mode||s.Array,this.onlyFile=e.onlyFile||!1,this.bindFuc=null,this.targetOverFlag=!1,this.init()}var e,n,r;return e=t,(n=[{key:"init",value:function(){this.targetDom&&(this.bindFuc={dragFuc:this.dragFuc.bind(this),getDrapFile:this.getDrapFile.bind(this),pasteFuc:this.pasteFuc.bind(this),mouseFuc:this.mouseFuc.bind(this)},this.targetDom.addEventListener("mouseenter",this.bindFuc.mouseFuc,!1),this.targetDom.addEventListener("mouseleave",this.bindFuc.mouseFuc,!1),document.addEventListener("paste",this.bindFuc.pasteFuc,!1),this.targetDom.addEventListener("dragover",this.bindFuc.dragFuc,!1),this.targetDom.addEventListener("dragleave",this.bindFuc.dragFuc,!1),this.targetDom.addEventListener("drop",this.bindFuc.getDrapFile,!1))}},{key:"destroy",value:function(){this.targetDom.removeEventListener("dragover",this.bindFuc.dragFuc,!1),this.targetDom.removeEventListener("dragleave",this.bindFuc.dragFuc,!1),this.targetDom.removeEventListener("drop",this.bindFuc.getDrapFile,!1),this.bindFuc=null}},{key:"mouseFuc",value:function(e){"mouseenter"===e.type?this.targetOverFlag=!0:this.targetOverFlag=!1}},{key:"dragFuc",value:function(e){return e.stopPropagation(),e.preventDefault(),this["dragover"===e.type?"dragoverFuc":"dragleaveFuc"].call(e.target),this}},{key:"getDrapFile",value:function(e){this.dragFuc(e),this.addDataTransfer(e.dataTransfer)}},{key:"pasteFuc",value:function(e){var t;this.targetOverFlag&&(t=document.activeElement,/textarea|input/i.test(t.nodeName)||this.addDataTransfer(e.clipboardData))}},{key:"errHanlder",value:function(e,t){(null==e?void 0:e.message)!==f.stop&&t&&t()}},{key:"addDataTransfer",value:function(e){var t=this,n=!0;if((n="function"==typeof this.beforeReadFuc?this.beforeReadFuc():n)&&null!=e&&null!=(n=e.items)&&n.length){for(var r=[],i=0;i<e.items.length;i++){var a;(a=e.items[i].webkitGetAsEntry())&&r.push(a)}return this.getContent(r).then(function(e){"function"==typeof t.readDataFuc&&t.readDataFuc(e)},function(e){t.errHanlder(e)})}}},{key:"getContent",value:function(u){var o=this;return new Promise(function(i,e){var a=[];(function t(n){var e=u[n];if(!e)return i(a);var r="tree"===o.mode?"getFileSystemEntryTree":"getFileSystemEntryArray";o[r](e,"").then(function(e){a.push.apply(a,l(e)),t(n+1)},function(e){o.errHanlder(e)})})(0)})}},{key:"ifPushValid",value:function(e){return"function"!=typeof this.filterFuc||this.filterFuc(e)}},{key:"pushItem",value:function(e,t){return this.ifPushValid(t)?(e.push(t),t):null}},{key:"entryForEach",value:function(){}},{key:"entryFileHandler",value:function(e,t,n){var r=this,i=t.resolve,a=t.reject,u=[];e.file(function(e){e=n(e);if("function"==typeof r.validFuc&&!r.validFuc(e))return a(new Error(f.stop));r.pushItem(u,e),i(u)})}},{key:"getFileSystemEntryTree",value:function(n){var a=this,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return new Promise(function(e,t){if(n){var r,i;if(!n.isFile)return n.isDirectory?(i={fullPath:u+(r=n).name,name:r.name,totalSize:0,type:"text/directory",file:new File([],u+r.name,{type:"text/directory"}),child:[]},a.ifPushValid(i)?void c(r,{endFuc:function(){return i.totalSize=i.child.reduce(function(e,t){return e+((null==t?void 0:t.size)||(null==t?void 0:t.totalSize))},0),e([i])},excFuc:function(e,t){var n=t.next;a.getFileSystemEntryTree(e,u+r.name+"/").then(function(e){var t;(t=i.child).push.apply(t,l(e)),n()},function(e){a.errHanlder(e,function(){n()})})}}):t(new Error(f.filter))):void e([]);a.entryFileHandler(n,{resolve:e,reject:t},function(e){return{size:e.size,fullPath:u+e.name,name:e.name,type:e.type,file:e}})}else e([])})}},{key:"getFileSystemEntryArray",value:function(a){var u=this,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return new Promise(function(e,t){if(a)if(a.isFile)u.entryFileHandler(a,{resolve:e,reject:t},function(e){return{size:e.size,fullPath:o+e.name,name:e.name,type:e.type,file:e}});else if(a.isDirectory){var r=a,i=[],n={fullPath:o+r.name,name:r.name,totalSize:0,type:"text/directory",file:new File([],o+r.name,{type:"text/directory"})};if(!u.onlyFile&&!u.pushItem(i,n))return t(new Error(f.filter));c(r,{endFuc:function(){return u.onlyFile||(i[0].totalSize=i.reduce(function(e,t){return e+((null==t?void 0:t.size)||0)},0)),e(i)},excFuc:function(e,t){var n=t.next;u.getFileSystemEntryArray(e,o+r.name+"/").then(function(e){console.log("results===",e),i.push.apply(i,l(e)),n()},function(e){u.errHanlder(e,function(){n()})})}})}else e([]);else e([])})}}])&&i(e.prototype,n),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.ModeType=s,e.ResHandle=d,e.dirReadEntry=c,e.errEnum=f,e.filterSize=function(e){return"number"!=typeof e?"":e<t(1)?e+" B":e<t(2)?(e/t(1)).toFixed(2)+" KB":e<t(3)?(e/t(2)).toFixed(2)+" MB":e<t(4)?(e/t(3)).toFixed(2)+" GB":(e/t(4)).toFixed(2)+" TB"},e.getFileExtension=function(e){var e=e instanceof File?e.name:e;return null!=(e=e.match(/\.([0-9a-z]+)(?:[\\?#]|$)/i)[1])?e:""},e.getTargetNode=n,e.selectFileChange=a,e.selectFolderChange=function(e,t){var n;return t===s.Array?a(e,function(e){return{file:e,fullPath:e.webkitRelativePath,name:e.name,size:e.size,type:e.type}}):(n=[],[].slice.call(e).forEach(function(i){var a=i.webkitRelativePath.split("/");a.reduce(function(e,t,n){var r=e.find(function(e){return e.name===t});return r?r.child||(r.child=[]):(r={name:t,child:[],type:"text/directory"},n===a.length-1&&(r.type=i.type,r.file=i,delete r.child),e.push(r),r.child)},n)}),u(n[0],{path:""}),n)},e.selectResource=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=Object.assign({},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e?{webkitdirectory:!0}:{},{type:"file",visibility:"hidden"}),r=document.createElement("input");return Object.keys(n).forEach(function(e){var t=n[e];r.setAttribute(e,t)}),r.click(),new Promise(function(t,n){r.addEventListener("change",function(){var e;r.files&&0!=(null==(e=r.files)?void 0:e.length)?(e=Array.from(r.files),t(e)):n()})})},Object.defineProperty(e,"__esModule",{value:!0})});
